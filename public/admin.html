<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#14532d" />
  <title>Admin Dashboard - PPDSB Pondok Pesantren Al Ikhsan Beji</title>

  <!-- Prevent Caching - Force fresh page load -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <parameter name="Expires" content="0" />

  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
  <link rel="manifest" href="/manifest.webmanifest">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" />

  <!-- Toastr CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />

  <!-- Chart.js for visual statistik -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #059669 0%, #047857 100%);
      --success-gradient: linear-gradient(135deg, #0f9d58 0%, #0a7a43 100%);
      --danger-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --warning-gradient: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      --info-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --sidebar-gradient: linear-gradient(180deg, #064e3b 0%, #065f46 100%);
    }

    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }

    /* Sidebar */
    .sidebar {
      min-height: 100vh;
      background: var(--sidebar-gradient);
      color: #fff;
      box-shadow: 4px 0 20px rgba(0, 0, 0, .1);
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      padding: 25px 20px;
      background: rgba(255, 255, 255, .1);
      border-bottom: 1px solid rgba(255, 255, 255, .1);
    }

    .sidebar-header h5 {
      font-weight: 700;
      letter-spacing: 1px;
      margin: 0;
    }

    .sidebar .nav-link {
      color: rgba(255, 255, 255, .85);
      padding: 15px 20px;
      margin: 5px 10px;
      border-radius: 12px;
      border-left: 4px solid transparent;
      transition: .3s;
      font-weight: 500;
    }

    .sidebar .nav-link:hover {
      color: #fff;
      background: rgba(255, 255, 255, .15);
      border-left-color: #fff;
      transform: translateX(5px);
    }

    .sidebar .nav-link.active {
      color: #fff;
      background: rgba(255, 255, 255, .2);
      border-left-color: #fff;
      box-shadow: 0 4px 15px rgba(0, 0, 0, .2);
    }

    .sidebar .nav-link i {
      margin-right: 12px;
      font-size: 1.2rem;
      width: 25px;
      text-align: center;
    }

    /* Dropdown collapse icon rotation */
    .sidebar .collapse-icon {
      transition: transform 0.3s ease;
    }

    .sidebar [aria-expanded="false"] .collapse-icon {
      transform: rotate(-90deg);
    }

    .sidebar [aria-expanded="true"] .collapse-icon {
      transform: rotate(0deg);
    }

    /* Submenu items */
    .sidebar .collapse .nav-link {
      padding: 8px 15px;
      font-size: 0.9rem;
      border-left: none;
      margin: 2px 5px;
    }

    .sidebar .collapse .nav-link:hover {
      transform: translateX(3px);
    }

    .user-badge {
      background: rgba(255, 255, 255, .15);
      padding: 10px 15px;
      border-radius: 10px;
      margin: 10px;
      color: #fff;
      font-weight: 600;
    }

    .user-badge i {
      margin-right: 8px;
    }

    .sidebar-footer {
      flex-shrink: 0;
      position: sticky;
      bottom: 0;
      background: var(--sidebar-gradient);
      z-index: 10;
    }

    /* Layout */
    .content-area {
      padding: 30px;
      min-height: 100vh;
    }

    .page-header {
      margin-bottom: 30px;
      padding: 20px;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 2px 15px rgba(0, 0, 0, .08);
    }

    .page-header h2 {
      color: #047857;
      font-weight: 700;
      margin: 0;
    }

    .page-header p {
      color: #6c757d;
      margin: 5px 0 0;
    }

    /* Cards / Stats */
    .stat-card {
      border: none;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, .1);
      transition: .3s;
      background: #fff;
      position: relative;
      overflow: hidden;
      animation: fadeInUp .5s ease;
    }

    .stat-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 5px;
      height: 100%;
      background: var(--primary-gradient);
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, .15);
    }

    .stat-card.success::before {
      background: var(--success-gradient);
    }

    .stat-card.danger::before {
      background: var(--danger-gradient);
    }

    .stat-card.warning::before {
      background: var(--warning-gradient);
    }

    .stat-card.info::before {
      background: var(--info-gradient);
    }

    .stat-card .icon-box {
      width: 60px;
      height: 60px;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      margin-bottom: 15px;
      color: #fff;
    }

    .stat-card.success .icon-box {
      background: linear-gradient(135deg, #0f9d58 0%, #0a7a43 100%);
    }

    .stat-card.danger .icon-box {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .stat-card.warning .icon-box {
      background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
    }

    .stat-card.info .icon-box {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .stat-card.primary .icon-box {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .stat-card h6 {
      color: #6c757d;
      font-weight: 600;
      font-size: .9rem;
      text-transform: uppercase;
      letter-spacing: .5px;
      margin: 10px 0;
    }

    .stat-card h3 {
      color: #047857;
      font-weight: 700;
      font-size: 2rem;
      margin: 0;
    }

    .stat-card small {
      color: #28a745;
      font-weight: 600;
    }

    /* Tabs */
    .nav-tabs {
      border: none;
      background: #fff;
      padding: 10px;
      border-radius: 15px;
      box-shadow: 0 2px 15px rgba(0, 0, 0, .08);
      margin-bottom: 25px;
    }

    .nav-tabs .nav-link {
      border: none;
      color: #6c757d;
      padding: 12px 25px;
      margin: 0 5px;
      border-radius: 10px;
      font-weight: 600;
      transition: .3s;
    }

    .nav-tabs .nav-link:hover {
      color: #047857;
      background: #ecfdf5;
    }

    .nav-tabs .nav-link.active {
      color: #fff;
      background: var(--primary-gradient);
      box-shadow: 0 4px 15px rgba(102, 126, 234, .4);
    }

    .nav-tabs .nav-link i {
      margin-right: 8px;
      font-size: 1.1rem;
    }

    /* Table & Cards */
    .card {
      border: none;
      border-radius: 15px;
      box-shadow: 0 2px 15px rgba(0, 0, 0, .08);
      margin-bottom: 20px;
    }

    .card-header {
      background: var(--primary-gradient);
      color: #fff;
      border-radius: 15px 15px 0 0 !important;
      padding: 20px;
      font-weight: 600;
    }

    .table {
      background: #fff;
      border-radius: 15px;
      overflow: hidden;
    }

    .table thead {
      background: var(--primary-gradient);
      color: #fff;
    }

    .table thead th {
      border: none;
      padding: 15px;
      font-weight: 600;
      text-transform: uppercase;
      font-size: .85rem;
      letter-spacing: .5px;
    }

    .table tbody td {
      padding: 15px;
      vertical-align: middle;
      border-bottom: 1px solid #f0f0f0;
    }

    .table tbody tr {
      transition: .3s;
    }

    .table tbody tr:hover {
      background: #f8f9ff;
      transform: scale(1.01);
    }

    .table-actions button {
      margin: 0 3px;
      border-radius: 8px;
      padding: 8px 15px;
      font-weight: 500;
      transition: .3s;
    }

    /* Buttons & Badges */
    .btn {
      border-radius: 10px;
      padding: 10px 20px;
      font-weight: 600;
      border: none;
      transition: .3s;
    }

    .btn-primary {
      background: var(--primary-gradient);
      box-shadow: 0 4px 15px rgba(102, 126, 234, .4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, .6);
    }

    .btn-success {
      background: var(--success-gradient);
      box-shadow: 0 4px 15px rgba(15, 157, 88, .4);
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(15, 157, 88, .6);
    }

    .btn-danger {
      background: var(--danger-gradient);
      box-shadow: 0 4px 15px rgba(245, 87, 108, .4);
    }

    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(245, 87, 108, .6);
    }

    .btn-warning {
      background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
      color: #fff;
      box-shadow: 0 4px 15px rgba(255, 167, 38, .4);
    }

    .btn-warning:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 167, 38, .6);
    }

    .btn-info {
      background: var(--info-gradient);
      box-shadow: 0 4px 15px rgba(79, 172, 254, .4);
    }

    .btn-info:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(79, 172, 254, .6);
    }

    .badge {
      padding: 8px 15px;
      border-radius: 8px;
      font-weight: 600;
      font-size: .8rem;
    }

    .badge.bg-success {
      background: var(--success-gradient) !important;
    }

    .badge.bg-danger {
      background: var(--danger-gradient) !important;
    }

    .badge.bg-warning {
      background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%) !important;
    }

    .badge.bg-info {
      background: var(--info-gradient) !important;
    }

    /* Modal */
    .modal-header {
      background: var(--primary-gradient);
      color: #fff;
      border-radius: 15px 15px 0 0;
    }

    .modal-content {
      border-radius: 15px;
      border: none;
      box-shadow: 0 10px 40px rgba(0, 0, 0, .2);
    }

    .modal-header .btn-close {
      filter: brightness(0) invert(1);
    }

    .preview-img {
      max-width: 100px;
      max-height: 100px;
      object-fit: cover;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, .1);
    }

    /* Forms */
    .form-control,
    .form-select {
      border-radius: 10px;
      border: 2px solid #e0e0e0;
      padding: 10px 15px;
      transition: .3s;
    }

    .form-control:focus,
    .form-select:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 .2rem rgba(102, 126, 234, .25);
    }

    .alert {
      border-radius: 12px;
      border: none;
      padding: 15px 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, .1);
    }

    /* Chart Containers */
    .chart-card-body {
      position: relative;
      min-height: 220px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chart-card-body canvas {
      width: 100% !important;
      height: 100% !important;
      min-height: 200px;
      max-height: 320px;
    }

    @media (min-width: 1200px) {
      .chart-card-body {
        min-height: 260px;
      }
    }

    .province-chart-row {
      height: 100%;
      width: 100%;
    }

    .province-chart-canvas {
      min-height: 260px;
      max-height: 360px;
      width: 100% !important;
    }


    /* ============================================
       RESPONSIVE DESIGN (Mobile-First Approach)
       ============================================ */

    /* Mobile Menu Toggle Button */
    .mobile-menu-toggle {
      display: none;
      position: fixed;
      top: 15px;
      left: 15px;
      z-index: 1040;
      background: var(--success-gradient);
      color: #fff;
      border: none;
      padding: 12px 18px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, .3);
      font-weight: 600;
      transition: .3s;
    }

    .mobile-menu-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, .4);
    }

    /* Sidebar Overlay for Mobile */
    .sidebar-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .6);
      z-index: 1040;
      backdrop-filter: blur(2px);
    }

    /* ============================================
       TABLET & MOBILE (< 992px)
       ============================================ */
    @media (max-width:991px) {

      /* Sidebar: Fixed & Hidden by Default */
      .sidebar {
        position: fixed;
        left: -280px;
        top: 0;
        z-index: 1050;
        width: 280px !important;
        transition: left .3s ease;
        box-shadow: 4px 0 30px rgba(0, 0, 0, .3);
        height: 100vh;
        max-height: 100vh;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }

      .sidebar.show {
        left: 0;
      }

      .sidebar-overlay.show {
        display: block;
      }

      /* Show Mobile Menu Toggle */
      .mobile-menu-toggle {
        display: block;
      }

      /* Content Area: Full Width */
      .content-area {
        padding: 20px 15px;
        width: 100%;
        margin-left: 0 !important;
      }

      /* Page Header */
      .page-header {
        flex-direction: column !important;
        align-items: flex-start !important;
        gap: 15px;
        padding: 15px;
      }

      .page-header h2 {
        font-size: 1.5rem;
      }

      .page-header p {
        font-size: .9rem;
      }

      /* Stat Cards */
      .stat-card {
        padding: 20px 15px;
        margin-bottom: 15px;
      }

      .stat-card h6 {
        font-size: .8rem;
      }

      .stat-card h3 {
        font-size: 1.5rem;
      }

      .stat-card .icon-box {
        width: 55px;
        height: 55px;
        font-size: 1.6rem;
      }

      /* Navigation Tabs */
      .nav-tabs {
        padding: 8px;
        overflow-x: auto;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
      }

      .nav-tabs .nav-link {
        padding: 10px 15px;
        font-size: .85rem;
        margin: 0 3px;
        white-space: nowrap;
      }

      .nav-tabs .nav-link i {
        font-size: 1rem;
      }

      /* Buttons */
      .btn {
        padding: 10px 16px;
        font-size: .9rem;
      }

      /* Table Actions */
      .table-actions {
        display: flex;
        flex-direction: column;
        gap: 8px;
        width: 100%;
      }

      .table-actions button,
      .table-actions .btn {
        width: 100%;
        padding: 8px 12px;
        font-size: .85rem;
      }

      /* Cards */
      .card {
        margin-bottom: 15px;
      }

      .card-header {
        padding: 15px;
        font-size: .95rem;
      }

      /* Modal */
      .modal-dialog {
        margin: 10px;
        max-width: calc(100% - 20px);
      }

      /* Forms */
      .form-control,
      .form-select {
        font-size: .9rem;
      }
    }

    /* ============================================
       MOBILE ONLY (< 768px)
       ============================================ */
    @media (max-width:767px) {

      /* Sidebar: Narrower */
      .sidebar {
        width: 260px !important;
        left: -260px;
      }

      .sidebar-footer {
        padding: 15px 10px !important;
        position: sticky;
        bottom: 0;
        background: var(--sidebar-gradient);
      }

      .sidebar-footer .btn {
        padding: 10px 12px !important;
        font-size: .85rem !important;
        min-height: 44px;
      }

      /* Content Area: Minimal Padding */
      .content-area {
        padding: 70px 10px 15px;
      }

      /* Page Header: Smaller */
      .page-header {
        padding: 12px;
      }

      .page-header h2 {
        font-size: 1.3rem;
      }

      .page-header p {
        font-size: .85rem;
        margin-top: 5px;
      }

      /* Stat Cards: Even Smaller */
      .stat-card {
        padding: 15px 12px;
      }

      .stat-card h6 {
        font-size: .7rem;
      }

      .stat-card h3 {
        font-size: 1.3rem;
      }

      .stat-card .icon-box {
        width: 45px;
        height: 45px;
        font-size: 1.4rem;
      }

      .stat-card small {
        font-size: .75rem;
      }

      /* Tables: Mobile-Optimized */
      .table {
        font-size: .85rem;
      }

      .table thead th {
        padding: 10px 8px;
        font-size: .75rem;
      }

      .table tbody td {
        padding: 10px 8px;
        font-size: .85rem;
      }

      /* Table: Hide Less Important Columns on Small Screens */
      .table th:nth-child(5),
      .table td:nth-child(5) {
        display: none;
      }

      /* Table Responsive: Horizontal Scroll */
      .table-responsive {
        border-radius: 10px;
        box-shadow: inset 0 0 0 1px #e0e0e0;
      }

      /* Navigation Tabs: Smaller */
      .nav-tabs .nav-link {
        padding: 8px 12px;
        font-size: .8rem;
      }

      /* Buttons: Stack & Full Width */
      .d-flex.gap-2 {
        flex-direction: column !important;
        gap: 10px !important;
      }

      .d-flex.gap-2 .btn {
        width: 100%;
        justify-content: center;
      }

      /* Modal: Full Screen */
      .modal-dialog {
        margin: 0;
        max-width: 100%;
        height: 100%;
      }

      .modal-content {
        height: 100%;
        border-radius: 0;
      }

      /* Forms: Full Width */
      .form-row,
      .row {
        margin: 0 -5px;
      }

      .form-row>*,
      .row>* {
        padding: 0 5px;
      }

      /* Badge: Smaller */
      .badge {
        padding: 6px 10px;
        font-size: .7rem;
      }

      /* Gelombang Management: Stack Forms */
      #gelombangContainer .card {
        margin-bottom: 15px;
      }

      #gelombangContainer .form-group {
        margin-bottom: 12px;
      }

      #gelombangContainer label {
        font-size: .85rem;
      }

      #gelombangContainer .btn {
        width: 100%;
        margin-top: 10px;
      }
    }

    /* ============================================
       EXTRA SMALL MOBILE (< 576px)
       ============================================ */
    @media (max-width:575px) {

      /* Mobile Toggle: Smaller */
      .mobile-menu-toggle {
        padding: 10px 14px;
        font-size: .85rem;
      }

      /* Sidebar: Even Narrower */
      .sidebar {
        width: 240px !important;
        left: -240px;
      }

      .sidebar-footer {
        padding: 12px 8px !important;
      }

      .sidebar-footer .btn {
        padding: 8px 10px !important;
        font-size: .8rem !important;
      }

      .sidebar-header h5 {
        font-size: 1rem;
      }

      .sidebar .nav-link {
        padding: 12px 15px;
        font-size: .85rem;
      }

      .sidebar .nav-link i {
        font-size: 1rem;
        width: 20px;
      }

      /* Content Area */
      .content-area {
        padding: 65px 8px 12px;
      }

      /* Page Header */
      .page-header {
        padding: 10px;
      }

      .page-header h2 {
        font-size: 1.2rem;
      }

      .page-header p {
        font-size: .8rem;
      }

      /* Stat Cards: Grid 2 Columns */
      .stat-card {
        padding: 12px 10px;
      }

      .stat-card h6 {
        font-size: .65rem;
      }

      .stat-card h3 {
        font-size: 1.1rem;
      }

      .stat-card .icon-box {
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
        margin-bottom: 10px;
      }

      .stat-card small {
        font-size: .7rem;
      }

      /* Tables: Ultra Compact */
      .table {
        font-size: .75rem;
      }

      .table thead th {
        padding: 8px 6px;
        font-size: .7rem;
      }

      .table tbody td {
        padding: 8px 6px;
        font-size: .75rem;
      }

      /* Hide More Columns on Extra Small Screens */
      .table th:nth-child(2),
      .table td:nth-child(2) {
        display: none;
      }

      .detail-payment-table th:nth-child(2),
      .detail-payment-table td:nth-child(2) {
        display: table-cell !important;
      }

      /* Navigation Tabs: Minimal */
      .nav-tabs {
        padding: 6px;
      }

      .nav-tabs .nav-link {
        padding: 8px 10px;
        font-size: .75rem;
      }

      .nav-tabs .nav-link i {
        display: none;
      }

      /* Buttons: Compact */
      .btn {
        padding: 8px 12px;
        font-size: .85rem;
      }

      /* Modal: Full Screen */
      .modal-body {
        padding: 15px;
      }

      .modal-header {
        padding: 12px 15px;
      }

      .modal-footer {
        padding: 10px 15px;
      }

      /* Forms: Compact */
      .form-control,
      .form-select {
        padding: 8px 12px;
        font-size: .85rem;
      }

      .form-label {
        font-size: .85rem;
      }

      /* Alert: Compact */
      .alert {
        padding: 10px 15px;
        font-size: .85rem;
      }
    }

    /* ============================================
       LANDSCAPE MOBILE (Small Height)
       ============================================ */
    @media (max-height:600px) and (max-width:991px) {
      .sidebar {
        max-height: 100vh;
        overflow-y: auto;
      }

      .modal-dialog {
        margin: 5px;
      }

      .modal-content {
        max-height: calc(100vh - 10px);
        overflow-y: auto;
      }
    }

    /* ============================================
       COMPONENT-SPECIFIC RESPONSIVE RULES
       ============================================ */

    /* Statistics Cards - Pondok Sections */
    @media (max-width:767px) {
      .col-md-4 {
        flex: 0 0 100%;
        max-width: 100%;
      }

      .card-body .d-flex {
        font-size: .9rem;
      }

      .card-body .badge {
        min-width: 45px;
      }
    }

    /* Table Action Buttons - Stack on Mobile */
    @media (max-width:767px) {
      table .btn-sm {
        padding: 6px 10px;
        font-size: .75rem;
        margin: 2px 0;
      }

      table .dropdown-menu {
        font-size: .85rem;
      }
    }

    /* Modal Detail Pendaftar - Optimize for Mobile */
    @media (max-width:767px) {
      #modalDetail .modal-body img {
        max-width: 80px !important;
        max-height: 80px !important;
      }

      #modalDetail dl dt,
      #modalDetail dl dd {
        font-size: .85rem;
      }

      #modalDetail .col-sm-4,
      #modalDetail .col-sm-8 {
        flex: 0 0 100%;
        max-width: 100%;
      }
    }

    /* Pembayaran Table - Mobile View */
    @media (max-width:767px) {
      #pembayaranTable img {
        max-width: 60px !important;
        max-height: 60px !important;
      }
    }

    /* Kelola Gelombang - Form Optimization */
    @media (max-width:767px) {
      #gelombangContainer .row {
        margin: 0;
      }

      #gelombangContainer .col-md-6,
      #gelombangContainer .col-md-4 {
        flex: 0 0 100%;
        max-width: 100%;
        padding: 0 0 10px;
      }

      #gelombangContainer .d-flex.gap-2 {
        flex-direction: column !important;
      }

      #gelombangContainer .form-check {
        margin: 10px 0;
      }
    }

    /* Top Action Buttons - Stack on Mobile */
    @media (max-width:767px) {
      .d-flex.justify-content-between {
        flex-direction: column !important;
        align-items: flex-start !important;
        gap: 12px;
      }

      .d-flex.justify-content-between h5 {
        font-size: 1rem;
      }
    }

    /* Hide Desktop-Only Elements on Mobile */
    @media (max-width:575px) {
      .desktop-only {
        display: none !important;
      }
    }

    /* Show Mobile-Only Elements */
    .mobile-only {
      display: none !important;
    }

    @media (max-width:767px) {
      .mobile-only {
        display: block !important;
      }
    }


    /* Utility: Touch-Friendly Tap Targets (44x44px minimum) */
    @media (max-width:991px) {

      .btn,
      .nav-link,
      .table-actions button {
        min-height: 44px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
    }

    /* ============================================
       CLICK FEEDBACK & PERFORMANCE
       ============================================ */

    /* Button click feedback - instant visual response */
    .btn:active,
    .nav-link:active {
      transform: scale(0.98) !important;
      opacity: 0.8;
      transition: all 0.1s ease !important;
    }

    /* Disable pointer events during loading to prevent double-click */
    .loading-state {
      pointer-events: none;
      opacity: 0.6;
      cursor: wait !important;
    }

    /* Show loading cursor during heavy operations */
    body.loading * {
      cursor: wait !important;
    }

    /* Animation */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px)
      }

      to {
        opacity: 1;
        transform: translateY(0)
      }
    }

    .stat-card:nth-child(1) {
      animation-delay: .1s;
    }

    .stat-card:nth-child(2) {
      animation-delay: .2s;
    }

    .stat-card:nth-child(3) {
      animation-delay: .3s;
    }

    .stat-card:nth-child(4) {
      animation-delay: .4s;
    }

    /* Pulse Animation for Activated Gelombang */
    @keyframes pulse {
      0% {
        transform: scale(1);
        box-shadow: 0 2px 15px rgba(0, 0, 0, .08);
      }

      50% {
        transform: scale(1.02);
        box-shadow: 0 8px 30px rgba(15, 157, 88, .4);
      }

      100% {
        transform: scale(1);
        box-shadow: 0 2px 15px rgba(0, 0, 0, .08);
      }
    }
  </style>
</head>

<body>
  <!-- Page Loading Overlay - FIRST ELEMENT to prevent flash -->
  <div id="pageLoadingOverlay"
    style="position:fixed;inset:0;background:linear-gradient(135deg,#0d9463 0%,#065f46 100%);z-index:9999;display:flex;align-items:center;justify-content:center;flex-direction:column;transition:opacity 0.4s ease;">
    <div class="spinner-border text-white" role="status" style="width:4rem;height:4rem;border-width:0.4rem">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-white fw-bold">Memeriksa sesi...</p>
    <p class="text-white-50" style="font-size:0.85rem">Mohon tunggu sebentar</p>
  </div>

  <!-- Main Content Container - hidden until auth check passes -->
  <div id="mainAdminContent" style="opacity:0;transition:opacity 0.3s ease;">

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleSidebar()">
      <i class="bi bi-list"></i> Menu
    </button>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <div class="d-flex">
      <!-- Sidebar -->
      <aside class="sidebar p-0" style="width:250px" id="sidebar">
        <div class="sidebar-header">
          <h5 class="text-white mb-1"><i class="bi bi-shield-lock-fill"></i> Admin Panel</h5>
          <small style="opacity:.8">PONDOK PESANTREN AL IKHSAN</small>
        </div>

        <div class="user-badge">
          <i class="bi bi-person-circle"></i>
          <span id="adminEmail">Admin</span>
        </div>

        <ul class="nav flex-column px-2 mt-3" style="flex-grow: 1; padding-bottom: 20px;">
          <!-- ===== KELOLA SANTRI (Dropdown Group) ===== -->
          <li class="nav-item mb-1">
            <a class="nav-link d-flex justify-content-between align-items-center" href="#" data-bs-toggle="collapse"
              data-bs-target="#menuKelolaSantri" aria-expanded="true"
              style="background: rgba(255,255,255,0.1); border-radius: 8px; font-weight: 600;">
              <span><i class="bi bi-people-fill me-2"></i>Kelola Santri</span>
              <i class="bi bi-chevron-down collapse-icon"></i>
            </a>
            <div class="collapse show" id="menuKelolaSantri">
              <ul class="nav flex-column ms-3 mt-1" style="border-left: 2px solid rgba(255,255,255,0.2);">
                <li class="nav-item">
                  <a class="nav-link active py-2" href="#" data-tab="pendaftar" onclick="switchTab('pendaftar')">
                    <i class="bi bi-person-lines-fill"></i> Data Pendaftar
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link py-2" href="#" data-tab="statistik" onclick="switchTab('statistik')">
                    <i class="bi bi-bar-chart-fill"></i> Statistik
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link py-2" href="#" data-tab="pembayaran" onclick="switchTab('pembayaran')">
                    <i class="bi bi-credit-card-fill"></i> Pembayaran
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link py-2" href="#" data-tab="payment-settings" onclick="switchTab('payment-settings')">
                    <i class="bi bi-gear-fill"></i> Pengaturan Pembayaran
                  </a>
                </li>
              </ul>
            </div>
          </li>

          <!-- ===== KELOLA WEBSITE (Dropdown Group) ===== -->
          <li class="nav-item mb-1">
            <a class="nav-link d-flex justify-content-between align-items-center" href="#" data-bs-toggle="collapse"
              data-bs-target="#menuKelolaWebsite" aria-expanded="true"
              style="background: rgba(255,255,255,0.1); border-radius: 8px; font-weight: 600;">
              <span><i class="bi bi-globe me-2"></i>Kelola Website</span>
              <i class="bi bi-chevron-down collapse-icon"></i>
            </a>
            <div class="collapse show" id="menuKelolaWebsite">
              <ul class="nav flex-column ms-3 mt-1" style="border-left: 2px solid rgba(255,255,255,0.2);">
                <!-- Less crucial items first -->
                <li class="nav-item">
                  <a class="nav-link py-2" href="#" data-tab="maintenance" onclick="switchTab('maintenance')">
                    <i class="bi bi-tools"></i> Mode Maintenance
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link py-2" href="#" data-tab="kontak" onclick="switchTab('kontak')">
                    <i class="bi bi-telephone"></i> Kontak
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link py-2" href="#" data-tab="brosur" onclick="switchTab('brosur')">
                    <i class="bi bi-file-earmark-text"></i> Brosur
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link py-2" href="#" data-tab="berita" onclick="switchTab('berita')">
                    <i class="bi bi-newspaper"></i> Berita
                  </a>
                </li>
                <!-- Medium importance -->
                <li class="nav-item">
                  <a class="nav-link py-2" href="#" data-tab="why" onclick="switchTab('why')">
                    <i class="bi bi-file-text"></i> Keunggulan Pondok
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link py-2" href="#" data-tab="hero-carousel" onclick="switchTab('hero-carousel')">
                    <i class="bi bi-person-bounding-box"></i> Gambar Santri
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link py-2" href="#" data-tab="hero" onclick="switchTab('hero')">
                    <i class="bi bi-images"></i> Gambar Bergerak
                  </a>
                </li>
                <!-- Most crucial at bottom -->
                <li class="nav-item">
                  <a class="nav-link py-2" href="#" data-tab="biaya" onclick="switchTab('biaya')">
                    <i class="bi bi-cash-stack"></i> Biaya
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link py-2" href="#" data-tab="syarat" onclick="switchTab('syarat')">
                    <i class="bi bi-clipboard-check"></i> Syarat Pendaftaran
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link py-2" href="#" data-tab="alur" onclick="switchTab('alur')">
                    <i class="bi bi-diagram-3"></i> Alur Pendaftaran
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link py-2" href="#" data-tab="gelombang" onclick="switchTab('gelombang')">
                    <i class="bi bi-calendar-range"></i> Kelola Gelombang
                  </a>
                </li>
              </ul>
            </div>
          </li>

          <!-- ===== PENGATURAN (Dropdown Group) ===== -->
          <li class="nav-item mb-1">
            <a class="nav-link d-flex justify-content-between align-items-center" href="#" data-bs-toggle="collapse"
              data-bs-target="#menuPengaturan" aria-expanded="false"
              style="background: rgba(255,255,255,0.1); border-radius: 8px; font-weight: 600;">
              <span><i class="bi bi-gear-fill me-2"></i>Pengaturan</span>
              <i class="bi bi-chevron-down collapse-icon"></i>
            </a>
            <div class="collapse" id="menuPengaturan">
              <ul class="nav flex-column ms-3 mt-1" style="border-left: 2px solid rgba(255,255,255,0.2);">
                <li class="nav-item">
                  <a class="nav-link py-2" href="#" data-tab="akun-admin" onclick="switchTab('akun-admin')">
                    <i class="bi bi-person-plus-fill"></i> Kelola Akun Admin
                  </a>
                </li>
              </ul>
            </div>
          </li>
        </ul>

        <!-- Sidebar Footer Buttons - Fixed at reasonable position -->
        <div class="sidebar-footer px-2 pb-3" style="padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
          <a href="/" class="btn btn-outline-light w-100 mb-2 d-flex align-items-center justify-content-center gap-2"
            style="background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.3); color: #fff; padding: 10px 15px; border-radius: 10px; font-weight: 500; transition: all 0.3s;"
            onmouseover="this.style.background='rgba(255,255,255,0.2)'; this.style.borderColor='rgba(255,255,255,0.5)'"
            onmouseout="this.style.background='rgba(255,255,255,0.1)'; this.style.borderColor='rgba(255,255,255,0.3)'">
            <i class="bi bi-house-fill"></i> Website
          </a>
          <button id="logoutBtn" type="button"
            class="btn btn-danger w-100 d-flex align-items-center justify-content-center gap-2"
            style="background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%); border: none; color: #fff; padding: 10px 15px; border-radius: 10px; font-weight: 500; transition: all 0.3s; box-shadow: 0 4px 15px rgba(245,87,108,0.4);"
            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(245,87,108,0.6)'"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(245,87,108,0.4)'">
            <i class="bi bi-box-arrow-right"></i> Logout
          </button>
        </div>

      </aside>

      <!-- Main Content -->
      <main class="flex-grow-1">
        <section class="content-area">
          <!-- Tab: Pendaftar -->
          <div id="tab-pendaftar" class="tab-content active">
            <div class="page-header d-flex justify-content-between align-items-center">
              <div>
                <h2><i class="bi bi-people-fill"></i> Data Pendaftar</h2>
                <p>Kelola data pendaftar Pondok Pesantren Al Ikhsan Beji</p>
              </div>
              <span id="updateTimePendaftar" class="badge bg-info text-dark">
                <i class="bi bi-clock-history"></i> Data update: -
              </span>
            </div>

            <div class="row g-3 mb-4">
              <div class="col-6 col-md-3">
                <div class="card stat-card primary">
                  <div class="card-body">
                    <div class="icon-box"><i class="bi bi-people-fill"></i></div>
                    <h6>Total Pendaftar</h6>
                    <h3 id="totalCount">0</h3>
                    <small><i class="bi bi-arrow-up"></i> Semua data</small>
                  </div>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="card stat-card warning">
                  <div class="card-body">
                    <div class="icon-box"><i class="bi bi-hourglass-split"></i></div>
                    <h6>Pending</h6>
                    <h3 id="pendingCount">0</h3>
                    <small><i class="bi bi-clock"></i> Menunggu</small>
                  </div>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="card stat-card info">
                  <div class="card-body">
                    <div class="icon-box"><i class="bi bi-pencil-square"></i></div>
                    <h6>Revisi</h6>
                    <h3 id="revisiCount">0</h3>
                    <small><i class="bi bi-arrow-repeat"></i> Perlu diperbaiki</small>
                  </div>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="card stat-card success">
                  <div class="card-body">
                    <div class="icon-box"><i class="bi bi-check-circle-fill"></i></div>
                    <h6>Diterima</h6>
                    <h3 id="diterimaCount">0</h3>
                    <small><i class="bi bi-trophy"></i> Berhasil</small>
                  </div>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="card stat-card danger">
                  <div class="card-body">
                    <div class="icon-box"><i class="bi bi-x-circle-fill"></i></div>
                    <h6>Ditolak</h6>
                    <h3 id="ditolakCount">0</h3>
                    <small><i class="bi bi-exclamation-triangle"></i> Tidak lolos</small>
                  </div>
                </div>
              </div>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-3">
              <h5 class="mb-0"><i class="bi bi-table"></i> Tabel Data Pendaftar</h5>
              <div class="d-flex flex-wrap gap-2 align-items-center">
                <!-- Search Input -->
                <div class="input-group input-group-sm" style="width: 250px;">
                  <span class="input-group-text bg-white border-end-0"><i class="bi bi-search"></i></span>
                  <input type="text" class="form-control border-start-0 ps-0" id="searchInput"
                    placeholder="Cari nama pendaftar..." style="border-left: none; box-shadow: none;">
                </div>

                <!-- Download ZIP Button -->
                <button class="btn btn-primary btn-sm" onclick="downloadAllZip()"
                  title="Download semua berkas dalam 1 file ZIP">
                  <i class="bi bi-file-earmark-zip"></i> ZIP
                </button>

                <!-- Excel Export Button -->
                <button class="btn btn-success btn-sm" onclick="exportToExcel()" title="Export ke Excel (.xlsx)">
                  <i class="bi bi-file-earmark-excel"></i> Excel
                </button>
              </div>
            </div>

            <div class="card">
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>NISN</th>
                        <th>Nama</th>
                        <th>Status</th>
                        <th>Tanggal</th>
                        <th>Aksi</th>
                      </tr>
                    </thead>
                    <tbody id="pendaftarTable">
                      <tr>
                        <td colspan="6" class="text-center">Loading...</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Pagination Controls (Bottom) -->
                <div class="d-flex justify-content-between align-items-center mt-3">
                  <div>
                    <button id="btnPrevPage" class="btn btn-outline-secondary btn-sm" onclick="previousPage()" disabled>
                      <i class="bi bi-chevron-left"></i> Previous
                    </button>
                    <button id="btnNextPage" class="btn btn-outline-secondary btn-sm" onclick="nextPage()" disabled>
                      Next <i class="bi bi-chevron-right"></i>
                    </button>
                  </div>
                  <div>
                    <span class="text-muted" id="pageInfo">Halaman 1</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Statistik -->
          <div id="tab-statistik" class="tab-content" style="display:none">
            <div class="page-header d-flex justify-content-between align-items-center">
              <div>
                <h2><i class="bi bi-bar-chart-fill"></i> Statistik Pendaftaran</h2>
                <p>Statistik jumlah pendaftar Pondok Pesantren Al Ikhsan Beji berdasarkan kategori</p>
              </div>
              <span id="updateTimeStatistik" class="badge bg-info text-dark">
                <i class="bi bi-clock-history"></i> Data update: -
              </span>
            </div>

            <div class="row g-4">
              <!-- Putra Induk -->
              <div class="col-md-4">
                <div class="card">
                  <div class="card-header" style="background:var(--primary-gradient)">
                    <h5 class="mb-0 text-white"><i class="bi bi-building-fill"></i> Pondok Putra Induk</h5>
                  </div>
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                      <span><i class="bi bi-book"></i> MTs (Tsanawiyah)</span>
                      <span class="badge bg-info fs-6" id="putraIndukMts">0</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                      <span><i class="bi bi-book-half"></i> MA (Aliyah)</span>
                      <span class="badge bg-info fs-6" id="putraIndukMa">0</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                      <span><i class="bi bi-mortarboard"></i> Kuliah</span>
                      <span class="badge bg-info fs-6" id="putraIndukKuliah">0</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
                      <strong>Total Pendaftar</strong>
                      <strong><span class="badge bg-primary fs-5" id="putraIndukTotal">0</span></strong>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Putra Tahfidz -->
              <div class="col-md-4">
                <div class="card">
                  <div class="card-header" style="background:var(--success-gradient)">
                    <h5 class="mb-0 text-white"><i class="bi bi-journal-bookmark-fill"></i> Pondok Putra Tahfidz</h5>
                  </div>
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                      <span>MTs (Tsanawiyah)</span>
                      <span class="badge bg-info fs-6" id="putraTahfidzMts">0</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                      <span>MA (Aliyah)</span>
                      <span class="badge bg-info fs-6" id="putraTahfidzMa">0</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                      <span>Kuliah</span>
                      <span class="badge bg-info fs-6" id="putraTahfidzKuliah">0</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
                      <strong>Total Pendaftar</strong>
                      <strong><span class="badge bg-success fs-5" id="putraTahfidzTotal">0</span></strong>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Putri -->
              <div class="col-md-4">
                <div class="card">
                  <div class="card-header" style="background:var(--danger-gradient)">
                    <h5 class="mb-0 text-white"><i class="bi bi-person-hearts"></i> Pondok Putri</h5>
                  </div>
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                      <span>MTs (Tsanawiyah)</span>
                      <span class="badge bg-info fs-6" id="putriMts">0</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                      <span>MA (Aliyah)</span>
                      <span class="badge bg-info fs-6" id="putriMa">0</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                      <span>Kuliah</span>
                      <span class="badge bg-info fs-6" id="putriKuliah">0</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
                      <strong>Total Pendaftar</strong>
                      <strong><span class="badge bg-danger fs-5" id="putriTotal">0</span></strong>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Hanya Sekolah - MTs -->
              <div class="col-md-6">
                <div class="card">
                  <div class="card-header" style="background:linear-gradient(135deg,#ffa726 0%,#fb8c00 100%)">
                    <h5 class="mb-0 text-white"><i class="bi bi-mortarboard-fill"></i> Hanya Sekolah - MTs (Tsanawiyah)
                    </h5>
                  </div>
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <span style="color:#495057;font-weight:500"><i class="bi bi-gender-male text-primary"></i>
                        Laki-laki</span>
                      <span class="badge bg-primary" id="hanyaSekolahMtsL">0</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
                      <span style="color:#495057;font-weight:500"><i class="bi bi-gender-female text-danger"></i>
                        Perempuan</span>
                      <span class="badge bg-danger" id="hanyaSekolahMtsP">0</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-2">
                      <strong style="color:#047857">Total MTs</strong>
                      <strong><span class="badge bg-warning text-dark fs-5" id="hanyaSekolahMtsTotal">0</span></strong>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Hanya Sekolah - MA -->
              <div class="col-md-6">
                <div class="card">
                  <div class="card-header" style="background:linear-gradient(135deg,#ffb74d 0%,#f57c00 100%)">
                    <h5 class="mb-0 text-white"><i class="bi bi-mortarboard-fill"></i> Hanya Sekolah - MA (Aliyah)</h5>
                  </div>
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <span style="color:#495057;font-weight:500"><i class="bi bi-gender-male text-primary"></i>
                        Laki-laki</span>
                      <span class="badge bg-primary" id="hanyaSekolahMaL">0</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
                      <span style="color:#495057;font-weight:500"><i class="bi bi-gender-female text-danger"></i>
                        Perempuan</span>
                      <span class="badge bg-danger" id="hanyaSekolahMaP">0</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-2">
                      <strong style="color:#047857">Total MA</strong>
                      <strong><span class="badge bg-warning text-dark fs-5" id="hanyaSekolahMaTotal">0</span></strong>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Chart row -->
              <div class="col-12">
                <div class="row g-4">
                  <div class="col-md-6">
                    <div class="card">
                      <div class="card-header" style="background:var(--info-gradient)">
                        <h5 class="mb-0 text-white"><i class="bi bi-people-fill"></i> Asrama vs Non Asrama</h5>
                      </div>
                      <div class="card-body chart-card-body">
                        <canvas id="chartAsrama" aria-label="Chart Asrama" role="img"></canvas>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="card">
                      <div class="card-header" style="background:var(--info-gradient)">
                        <h5 class="mb-0 text-white"><i class="bi bi-gender-ambiguous"></i> Gender (L vs P)</h5>
                      </div>
                      <div class="card-body chart-card-body">
                        <canvas id="chartGender" aria-label="Chart Gender" role="img"></canvas>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Asal Provinsi -->
              <div class="col-12">
                <div class="card">
                  <div class="card-header" style="background:linear-gradient(135deg,#3b82f6 0%,#0ea5e9 100%)">
                    <h5 class="mb-0 text-white"><i class="bi bi-geo-alt-fill"></i> Asal Provinsi Pendaftar</h5>
                  </div>
                  <div class="card-body chart-card-body">
                    <div class="row province-chart-row">
                      <div class="col-lg-8 mb-3 mb-lg-0">
                        <canvas id="chartProvince" class="province-chart-canvas" aria-label="Chart Asal Provinsi"
                          role="img"></canvas>
                      </div>
                      <div class="col-lg-4">
                        <h6 class="text-muted mb-2">Top Provinsi</h6>
                        <ul class="list-group list-group-flush small" id="provinceTopList">
                          <li class="list-group-item">Memuat data...</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Pembayaran -->
          <div id="tab-pembayaran" class="tab-content" style="display:none">
            <div class="page-header d-flex justify-content-between align-items-center">
              <div>
                <h2><i class="bi bi-credit-card-fill"></i> Data Pembayaran</h2>
                <p>Kelola data pembayaran dan verifikasi
                  <span class="badge bg-success ms-2"><i class="bi bi-arrow-repeat"></i> Auto Refresh 30s</span>
                </p>
              </div>
              <span id="updateTimePembayaran" class="badge bg-info text-dark">
                <i class="bi bi-clock-history"></i> Data update: -
              </span>
            </div>

            <div class="row mb-4 g-3">
              <div class="col-md-3">
                <div class="card stat-card warning">
                  <div class="card-body">
                    <div class="icon-box"><i class="bi bi-hourglass-split"></i></div>
                    <h6>Pending</h6>
                    <h3 id="statPending">0</h3>
                    <small><i class="bi bi-clock"></i> Menunggu verifikasi</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card stat-card success">
                  <div class="card-body">
                    <div class="icon-box"><i class="bi bi-check-circle-fill"></i></div>
                    <h6>Verified</h6>
                    <h3 id="statVerified">0</h3>
                    <small><i class="bi bi-shield-check"></i> Terverifikasi</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card stat-card danger">
                  <div class="card-body">
                    <div class="icon-box"><i class="bi bi-x-circle-fill"></i></div>
                    <h6>Rejected</h6>
                    <h3 id="statRejected">0</h3>
                    <small><i class="bi bi-exclamation-triangle"></i> Ditolak</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card stat-card primary">
                  <div class="card-body">
                    <div class="icon-box"><i class="bi bi-currency-dollar"></i></div>
                    <h6>Total Revenue</h6>
                    <h3 class="mb-0" id="statRevenue">Rp 0</h3>
                  </div>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>No</th>
                        <th>NISN</th>
                        <th>Nama Lengkap</th>
                        <th>Jumlah</th>
                        <th>Status</th>
                        <th>Tanggal Upload</th>
                        <th>Aksi</th>
                      </tr>
                    </thead>
                    <tbody id="pembayaranTableBody">
                      <tr>
                        <td colspan="7" class="text-center">
                          <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Kelola Gelombang -->
          <div id="tab-gelombang" class="tab-content" style="display:none">
            <div class="page-header">
              <h2><i class="bi bi-calendar-range"></i> Kelola Gelombang Pendaftaran</h2>
              <p>Atur tanggal, tahun ajaran, dan status aktif untuk setiap gelombang pendaftaran</p>
            </div>

            <div id="gelombangContainer">
              <!-- Loading state -->
              <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Memuat...</span>
                </div>
                <p class="text-muted mt-3">Memuat data gelombang...</p>
              </div>
            </div>
          </div>

          <!-- Tab: Berita -->
          <div id="tab-berita" class="tab-content" style="display:none">
            <div class="page-header">
              <h2><i class="bi bi-newspaper"></i> Kelola Berita</h2>
              <p>Kelola berita dan artikel untuk website (Bilingual: Indonesia & English)</p>
            </div>

            <div class="row g-3">
              <div class="col-lg-5">
                <div class="card h-100">
                  <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-plus-circle"></i> Tambah / Edit Berita</h5>
                  </div>
                  <div class="card-body">
                    <form id="beritaForm">
                      <input type="hidden" id="beritaId">
                      <div class="mb-3">
                        <label class="form-label d-flex align-items-center gap-2">
                          <i class="bi bi-translate"></i>
                          Bahasa Konten
                        </label>
                        <div class="btn-group btn-group-sm" id="beritaLangSwitch" role="group"
                          aria-label="Pilih bahasa berita">
                          <button type="button" class="btn btn-success active" data-berita-lang-button="id">
                            <span class="me-1" aria-hidden="true"></span>
                            Indonesia
                          </button>
                          <button type="button" class="btn btn-outline-success" data-berita-lang-button="en">
                            <span class="me-1" aria-hidden="true"></span>
                            English
                          </button>
                        </div>
                        <small class="text-muted d-block mt-2">
                          Isi judul dan konten dalam dua bahasa. Gambar dan status publikasi berlaku untuk semua bahasa.
                        </small>
                      </div>

                      <div class="berita-lang-pane" data-berita-lang-pane="id">
                        <div class="mb-3">
                          <label for="beritaTitle_id" class="form-label">Judul (Bahasa Indonesia)</label>
                          <input type="text" class="form-control" id="beritaTitle_id"
                            placeholder="Contoh: Selamat Datang Santri Baru 2026">
                        </div>
                        <div class="mb-3">
                          <label for="beritaContent_id" class="form-label">Konten (Bahasa Indonesia)</label>
                          <textarea class="form-control" id="beritaContent_id" rows="6"
                            placeholder="Tulis konten berita dalam Bahasa Indonesia"></textarea>
                        </div>
                      </div>

                      <div class="berita-lang-pane d-none" data-berita-lang-pane="en">
                        <div class="mb-3">
                          <label for="beritaTitle_en" class="form-label">Title (English)</label>
                          <input type="text" class="form-control" id="beritaTitle_en"
                            placeholder="Example: Welcome New Students 2026">
                        </div>
                        <div class="mb-3">
                          <label for="beritaContent_en" class="form-label">Content (English)</label>
                          <textarea class="form-control" id="beritaContent_en" rows="6"
                            placeholder="Write news content in English"></textarea>
                        </div>
                      </div>

                      <div class="mb-3">
                        <label for="beritaImageFile" class="form-label">Gambar Berita (Opsional)</label>
                        <input type="file" class="form-control" id="beritaImageFile" accept="image/*">
                        <small class="text-muted">Format: JPG, PNG, WebP (Max 2MB)</small>

                        <!-- Hidden field to store image URL -->
                        <input type="hidden" id="beritaImageUrl">

                        <!-- Preview -->
                        <div id="beritaImagePreview" class="mt-2" style="display:none;">
                          <img id="beritaPreviewImg" src="" class="img-thumbnail" style="max-height: 150px;">
                          <button type="button" class="btn btn-sm btn-danger ms-2" onclick="clearBeritaImage()">
                            <i class="bi bi-trash"></i> Hapus
                          </button>
                        </div>
                      </div>

                      <div class="mb-3">
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="beritaIsPublished">
                          <label class="form-check-label" for="beritaIsPublished">
                            <i class="bi bi-check-circle"></i> Publikasikan berita
                          </label>
                        </div>
                        <small class="text-muted">Jika dicentang, berita akan tampil di website publik</small>
                      </div>

                      <div class="mb-3">
                        <label for="beritaPublishedDate" class="form-label">
                          <i class="bi bi-calendar-event"></i> Tanggal Publikasi (Opsional)
                        </label>
                        <input type="date" class="form-control" id="beritaPublishedDate">
                        <small class="text-muted">Kosongkan untuk menggunakan tanggal saat ini. Tanggal ini akan tampil
                          di
                          homepage.</small>
                      </div>

                      <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary flex-grow-1" id="btnSaveBerita">
                          <i class="bi bi-save"></i> Simpan Berita
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="btnResetBerita">
                          <i class="bi bi-x-circle"></i> Reset
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              <div class="col-lg-7">
                <div class="card h-100">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-list-ul"></i> Daftar Berita</h5>
                    <button type="button" class="btn btn-light btn-sm" onclick="loadBeritaItems()">
                      <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table table-hover align-middle">
                        <thead>
                          <tr>
                            <th style="width:80px">Urutan</th>
                            <th>Judul</th>
                            <th style="width:120px">Tanggal</th>
                            <th style="width:100px">Status</th>
                            <th>Aksi</th>
                          </tr>
                        </thead>
                        <tbody id="beritaTableBody">
                          <tr>
                            <td colspan="5" class="text-center text-muted py-4">
                              <i class="bi bi-arrow-clockwise me-2"></i>Data belum dimuat
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <small class="text-muted">Gunakan tombol panah untuk mengatur urutan berita.</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Gambar Santri (Hero Section) -->
          <div id="tab-hero-carousel" class="tab-content" style="display:none">
            <div class="page-header">
              <h2><i class="bi bi-person-bounding-box"></i> Kelola Gambar Santri</h2>
              <p>Kelola gambar santri PNG transparan yang muncul di <strong>hero section utama</strong> (carousel dengan
                3
                slide)</p>
            </div>

	            <!-- Info Alert -->
	            <div class="alert alert-info mb-4">
	              <i class="bi bi-info-circle-fill"></i> <strong>Panduan Gambar:</strong>
	              <ul class="mb-0 mt-2">
	                <li><strong>Format:</strong> PNG transparan (disarankan) atau WebP transparan</li>
	                <li><strong>Ukuran:</strong> Rekomendasi portrait (mis. 8001000px atau lebih)</li>
	                <li><strong>Ukuran file:</strong> Maksimal 5 MB</li>
	                <li><strong>Konten:</strong> Foto santri/siswa (1 orang) yang akan ditampilkan di hero section</li>
	                <li><strong>Penempatan:</strong> Muncul di sisi kanan teks hero (Slide 13, maksimal 3 gambar)</li>
	                <li><strong>Catatan:</strong> Upload pada slide yang sama akan mengganti gambar sebelumnya</li>
	              </ul>
	            </div>

            <!-- Upload Section -->
            <div class="card mb-4">
              <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-cloud-upload"></i> Upload Gambar Santri</h5>
              </div>
              <div class="card-body">
                <form id="heroCarouselUploadForm">
                  <div class="row">
	                    <div class="col-md-6">
	                      <div class="mb-3">
	                        <label for="heroCarouselImageInput" class="form-label">Pilih Gambar (PNG/WebP)</label>
	                        <input type="file" class="form-control" id="heroCarouselImageInput"
	                          accept="image/png,image/webp" required>
	                        <small class="text-muted">Format: PNG transparan atau WebP transparan. Maks 5MB.</small>
	                      </div>
                      <div class="mb-3">
                        <label for="heroCarouselSlideOrder" class="form-label">Urutan Slide</label>
                        <select class="form-select" id="heroCarouselSlideOrder">
                          <option value="1">Slide 1</option>
                          <option value="2">Slide 2</option>
                          <option value="3">Slide 3</option>
                        </select>
                      </div>
                      <div class="mb-3">
                        <label for="heroCarouselAltText" class="form-label">Alt Text (Deskripsi)</label>
                        <input type="text" class="form-control" id="heroCarouselAltText"
                          placeholder="Santri Al Ikhsan Beji" value="Santri Al Ikhsan Beji">
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label class="form-label">Preview:</label>
                        <div id="heroCarouselImagePreview" class="border rounded p-3 text-center bg-light"
                          style="min-height: 200px; display: flex; align-items: center; justify-content: center;">
                          <div class="text-muted">
                            <i class="bi bi-image" style="font-size: 3rem;"></i>
                            <p class="mb-0 mt-2">Pilih gambar untuk melihat preview</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary" id="btnUploadHeroCarousel">
                      <i class="bi bi-upload"></i> Upload Gambar
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="resetHeroCarouselForm()">
                      <i class="bi bi-x-circle"></i> Reset
                    </button>
                  </div>
                </form>
              </div>
            </div>

            <!-- Daftar Gambar Santri -->
            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-collection"></i> Gambar Santri (<span
                    id="heroCarouselImageCount">0</span>/3)</h5>
                <button class="btn btn-sm btn-outline-light" onclick="loadHeroCarouselImages()">
                  <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
              </div>
              <div class="card-body">
                <div id="heroCarouselImagesContainer">
                  <!-- Loading state -->
                  <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="text-muted mt-3">Memuat gambar santri...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Gambar Bergerak -->
          <div id="tab-hero" class="tab-content" style="display:none">
            <div class="page-header">
              <h2><i class="bi bi-images"></i> Kelola Gambar Bergerak</h2>
              <p>Kelola gambar slider di section bawah hero (Auto-slide 4 detik, <strong>Gambar penuh tanpa
                  transparansi/overlay</strong>)</p>
            </div>

            <!-- Upload Section -->
            <div class="card mb-4">
              <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-cloud-upload"></i> Upload Hero Image</h5>
              </div>
              <div class="card-body">
                <div class="alert alert-info mb-3">
                  <i class="bi bi-info-circle"></i> <strong>Catatan:</strong>
                  <ul class="mb-0 mt-2">
                    <li>Maksimal 5 gambar slider</li>
                    <li>Gambar akan auto-slide setiap 4 detik di section bawah hero</li>
                    <li><strong>Gambar tampil penuh tanpa transparansi/overlay</strong> (full opacity)</li>
                    <li>Gunakan gambar landscape (16:9 atau 21:9) untuk hasil terbaik</li>
                    <li>Ukuran file maksimal: 5 MB</li>
                  </ul>
                </div>

                <form id="heroUploadForm">
                  <div class="mb-3">
                    <label for="heroImageInput" class="form-label">Pilih Gambar Hero</label>
                    <input type="file" class="form-control" id="heroImageInput" accept="image/*" required>
                    <small class="text-muted">Format: JPG, PNG, WEBP (Rekomendasi: 1920x1080px atau lebih)</small>
                  </div>

                  <!-- Image Preview -->
                  <div id="heroImagePreview" class="mb-3" style="display:none">
                    <label class="form-label">Preview:</label>
                    <div class="position-relative" style="max-width: 600px;">
                      <img id="heroPreviewImg" src="" class="img-fluid rounded shadow" alt="Preview">
                      <!-- NO OVERLAY - Image will display full opacity in slider -->
                    </div>
                    <small class="text-muted d-block mt-2"><i class="bi bi-eye"></i> Preview: Gambar akan tampil penuh
                      tanpa overlay di website</small>
                  </div>

                  <button type="submit" class="btn btn-primary" id="btnUploadHero">
                    <i class="bi bi-upload"></i> Upload Gambar
                  </button>
                  <button type="button" class="btn btn-secondary" onclick="resetHeroForm()">
                    <i class="bi bi-x-circle"></i> Cancel
                  </button>
                </form>
              </div>
            </div>

            <!-- Hero Images List -->
            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-collection"></i> Hero Images (<span id="heroImageCount">0</span>/5)
                </h5>
                <button class="btn btn-sm btn-outline-light" onclick="loadHeroImages()">
                  <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
              </div>
              <div class="card-body">
                <div id="heroImagesContainer">
                  <!-- Loading state -->
                  <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="text-muted mt-3">Memuat hero images...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Keunggulan Pondok -->
          <div id="tab-why" class="tab-content" style="display:none">
            <div class="page-header">
              <h2><i class="bi bi-file-text"></i> Kelola Keunggulan Pondok</h2>
              <p>Edit narasi di section "Mengapa Memilih Pondok Pesantren Al Ikhsan Beji?"</p>
            </div>

            <div class="card">
              <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-pencil-square"></i> Edit Narasi Keunggulan Pondok</h5>
              </div>
              <div class="card-body">
                <form id="whySectionForm" onsubmit="saveWhySection(event)">
                  <div class="mb-3">
                    <label class="form-label d-flex align-items-center gap-2">
                      <i class="bi bi-translate"></i>
                      Bahasa Konten
                    </label>
                    <div class="btn-group btn-group-sm" id="whyLangSwitch" role="group"
                      aria-label="Pilih bahasa Keunggulan Pondok">
                      <button type="button" class="btn btn-warning active" data-why-lang-button="id">
                        <span class="me-1" aria-hidden="true"></span>
                        Indonesia
                      </button>
                      <button type="button" class="btn btn-outline-warning" data-why-lang-button="en">
                        <span class="me-1" aria-hidden="true"></span>
                        English
                      </button>
                    </div>
                    <small class="text-muted d-block mt-2">
                      Lengkapi konten dalam Bahasa Indonesia dan Bahasa Inggris. Pilih tab bahasa di atas untuk mengisi
                      masing-masing versi.
                    </small>
                  </div>

                  <div class="why-lang-pane" data-why-lang-pane="id">
                    <div class="mb-3">
                      <label for="whyTitle_id" class="form-label">
                        <i class="bi bi-type-h1"></i> Judul (Bahasa Indonesia)
                      </label>
                      <input type="text" class="form-control" id="whyTitle_id"
                        placeholder="Mengapa Memilih Pondok Pesantren Al Ikhsan Beji?">
                      <small class="text-muted">Judul utama dalam Bahasa Indonesia.</small>
                    </div>

                    <div class="mb-3">
                      <label for="whySubtitle_id" class="form-label">
                        <i class="bi bi-type"></i> Subtitle (Opsional)
                      </label>
                      <input type="text" class="form-control" id="whySubtitle_id"
                        placeholder="Pendidikan islami terpadu: tahfidz Al-Qur'an, akhlak mulia, dan ilmu pengetahuan">
                      <small class="text-muted">Subtitle atau deskripsi singkat dalam Bahasa Indonesia.</small>
                    </div>

                    <div class="mb-3">
                      <label for="whyContent_id" class="form-label">
                        <i class="bi bi-file-text"></i> Konten Narasi
                      </label>
                      <textarea class="form-control" id="whyContent_id" rows="8"
                        placeholder="Tuliskan narasi lengkap dalam Bahasa Indonesia. Gunakan baris baru untuk paragraf baru."></textarea>
                      <small class="text-muted">Narasi akan tampil sebagai paragraf biasa.</small>
                    </div>
                  </div>

                  <div class="why-lang-pane d-none" data-why-lang-pane="en">
                    <div class="mb-3">
                      <label for="whyTitle_en" class="form-label">
                        <i class="bi bi-type-h1"></i> Title (English)
                      </label>
                      <input type="text" class="form-control" id="whyTitle_en"
                        placeholder="Why Choose Al Ikhsan Islamic Boarding School?">
                      <small class="text-muted">Main heading in English.</small>
                    </div>

                    <div class="mb-3">
                      <label for="whySubtitle_en" class="form-label">
                        <i class="bi bi-type"></i> Subtitle (Optional)
                      </label>
                      <input type="text" class="form-control" id="whySubtitle_en"
                        placeholder="Integrated Islamic education: tahfidz, character, and academics.">
                      <small class="text-muted">Short description in English.</small>
                    </div>

                    <div class="mb-3">
                      <label for="whyContent_en" class="form-label">
                        <i class="bi bi-file-text"></i> Narrative Content
                      </label>
                      <textarea class="form-control" id="whyContent_en" rows="8"
                        placeholder="Write the full narrative in English. Use new lines for new paragraphs."></textarea>
                      <small class="text-muted">Displayed as paragraph text on the landing page.</small>
                    </div>
                  </div>

                  <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary" id="btnSaveWhy">
                      <i class="bi bi-save"></i> Simpan Perubahan
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="loadWhySectionData()">
                      <i class="bi bi-arrow-clockwise"></i> Reset / Muat Ulang
                    </button>
                  </div>
                </form>

                <!-- Preview Section -->
                <div class="mt-4">
                  <h6 class="mb-3"><i class="bi bi-eye"></i> Preview</h6>
                  <div class="border rounded p-4 bg-light" id="whyPreview">
                    <p class="text-muted text-center mb-0">Preview akan muncul setelah mengisi form</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Alur Pendaftaran -->
          <div id="tab-alur" class="tab-content" style="display:none">
            <div class="page-header">
              <h2><i class="bi bi-diagram-3"></i> Kelola Alur Pendaftaran</h2>
              <p>Susun langkah-langkah pendaftaran santri baru</p>
            </div>

            <div class="row g-3">
              <div class="col-lg-4">
                <div class="card h-100">
                  <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-pencil-square"></i> Form Langkah</h5>
                  </div>
                  <div class="card-body">
                    <form id="alurForm">
                      <input type="hidden" id="alurId">
                      <div class="mb-3">
                        <label class="form-label d-flex align-items-center gap-2">
                          <i class="bi bi-translate"></i>
                          Bahasa Konten
                        </label>
                        <div class="btn-group btn-group-sm" id="alurLangSwitch" role="group"
                          aria-label="Pilih bahasa langkah alur">
                          <button type="button" class="btn btn-success active" data-alur-lang-button="id">
                            <span class="me-1" aria-hidden="true"></span>
                            Indonesia
                          </button>
                          <button type="button" class="btn btn-outline-success" data-alur-lang-button="en">
                            <span class="me-1" aria-hidden="true"></span>
                            English
                          </button>
                        </div>
                        <small class="text-muted d-block mt-2">
                          Isi judul dan deskripsi dalam Bahasa Indonesia dan Bahasa Inggris. Gunakan tombol di atas
                          untuk
                          beralih.
                        </small>
                      </div>

                      <div class="alur-lang-pane" data-alur-lang-pane="id">
                        <div class="mb-3">
                          <label for="alurTitle_id" class="form-label">Judul Langkah (Bahasa Indonesia)</label>
                          <input type="text" class="form-control" id="alurTitle_id"
                            placeholder="Contoh: Pendaftaran Online">
                        </div>
                        <div class="mb-3">
                          <label for="alurDescription_id" class="form-label">Deskripsi (Bahasa Indonesia)</label>
                          <textarea class="form-control" id="alurDescription_id" rows="4"
                            placeholder="Deskripsi singkat langkah dalam Bahasa Indonesia"></textarea>
                        </div>
                      </div>

                      <div class="alur-lang-pane d-none" data-alur-lang-pane="en">
                        <div class="mb-3">
                          <label for="alurTitle_en" class="form-label">Step Title (English)</label>
                          <input type="text" class="form-control" id="alurTitle_en"
                            placeholder="Example: Online Registration">
                        </div>
                        <div class="mb-3">
                          <label for="alurDescription_en" class="form-label">Description (English)</label>
                          <textarea class="form-control" id="alurDescription_en" rows="4"
                            placeholder="Write the step description in English"></textarea>
                        </div>
                      </div>

                      <div class="mb-3">
                        <label class="form-label d-flex align-items-center gap-2">
                          <i class="bi bi-info-circle"></i>
                          Catatan
                        </label>
                        <div class="alert alert-light border">
                          <ul class="mb-0 small text-muted">
                            <li>Bahasa Indonesia ditampilkan sebagai default di admin dan publik.</li>
                            <li>Bahasa Inggris digunakan otomatis saat pengunjung memilih English.</li>
                          </ul>
                        </div>
                      </div>
                      <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary flex-grow-1" id="btnSaveAlur">
                          <i class="bi bi-save"></i> Simpan Langkah
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="btnResetAlur">
                          <i class="bi bi-x-circle"></i> Reset
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              <div class="col-lg-8">
                <div class="card h-100">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-list-ol"></i> Daftar Langkah</h5>
                    <button type="button" class="btn btn-light btn-sm" onclick="loadAlurSteps()">
                      <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table table-hover align-middle">
                        <thead>
                          <tr>
                            <th style="width:80px">Urutan</th>
                            <th>Judul</th>
                            <th>Deskripsi</th>
                            <th style="width:180px">Aksi</th>
                          </tr>
                        </thead>
                        <tbody id="alurTableBody">
                          <tr>
                            <td colspan="4" class="text-center text-muted py-4">
                              <i class="bi bi-arrow-clockwise me-2"></i>Data belum dimuat
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <small class="text-muted">Gunakan tombol panah untuk mengatur urutan langkah.</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Syarat Pendaftaran -->
          <div id="tab-syarat" class="tab-content" style="display:none">
            <div class="page-header">
              <h2><i class="bi bi-clipboard-check"></i> Kelola Syarat Pendaftaran</h2>
              <p>Daftar dokumen dan persyaratan pendaftaran santri baru</p>
            </div>

            <div class="row g-3">
              <div class="col-lg-4">
                <div class="card h-100">
                  <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-plus-circle"></i> Tambah / Edit Syarat</h5>
                  </div>
                  <div class="card-body">
                    <form id="syaratForm">
                      <input type="hidden" id="syaratId">
                      <div class="mb-3">
                        <label class="form-label d-flex align-items-center gap-2">
                          <i class="bi bi-translate"></i>
                          Bahasa Konten
                        </label>
                        <div class="btn-group btn-group-sm" role="group" id="syaratLangSwitch"
                          aria-label="Pilih bahasa syarat">
                          <button type="button" class="btn btn-success active" data-syarat-lang-button="id">
                            <span class="me-1" aria-hidden="true"></span>
                            Indonesia
                          </button>
                          <button type="button" class="btn btn-outline-success" data-syarat-lang-button="en">
                            <span class="me-1" aria-hidden="true"></span>
                            English
                          </button>
                        </div>
                        <small class="text-muted d-block mt-2">
                          Isi nama persyaratan dalam Bahasa Indonesia dan Bahasa Inggris. Pilih tab bahasa di atas untuk
                          beralih.
                        </small>
                      </div>

                      <div class="syarat-lang-pane" data-syarat-lang-pane="id">
                        <div class="mb-3">
                          <label for="syaratName_id" class="form-label">Nama Syarat (Bahasa Indonesia)</label>
                          <input type="text" class="form-control" id="syaratName_id"
                            placeholder="Contoh: Fotokopi Akta Kelahiran">
                        </div>
                      </div>

                      <div class="syarat-lang-pane d-none" data-syarat-lang-pane="en">
                        <div class="mb-3">
                          <label for="syaratName_en" class="form-label">Requirement Name (English)</label>
                          <input type="text" class="form-control" id="syaratName_en"
                            placeholder="Example: Birth Certificate Copy">
                        </div>
                      </div>

                      <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary flex-grow-1" id="btnSaveSyarat">
                          <i class="bi bi-save"></i> Simpan Syarat
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="btnResetSyarat">
                          <i class="bi bi-x-circle"></i> Reset
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              <div class="col-lg-8">
                <div class="card h-100">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-list-check"></i> Daftar Syarat</h5>
                    <button type="button" class="btn btn-light btn-sm" onclick="loadSyaratItems()">
                      <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table table-hover align-middle">
                        <thead>
                          <tr>
                            <th style="width:80px">Urutan</th>
                            <th>Syarat</th>
                            <th style="width:180px">Aksi</th>
                          </tr>
                        </thead>
                        <tbody id="syaratTableBody">
                          <tr>
                            <td colspan="3" class="text-center text-muted py-4">
                              <i class="bi bi-arrow-clockwise me-2"></i>Data belum dimuat
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <small class="text-muted">Gunakan tombol panah untuk mengatur urutan persyaratan.</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Biaya -->
          <div id="tab-biaya" class="tab-content" style="display:none">
            <div class="page-header">
              <h2><i class="bi bi-cash-stack"></i> Kelola Biaya Pendaftaran</h2>
              <p>Atur rincian biaya pendaftaran dan pendidikan</p>
            </div>

            <div class="row g-3">
              <div class="col-lg-4">
                <div class="card h-100">
                  <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-plus-circle"></i> Tambah / Edit Biaya</h5>
                  </div>
                  <div class="card-body">
                    <form id="biayaForm">
                      <input type="hidden" id="biayaId">
                      <div class="mb-3">
                        <label class="form-label d-flex align-items-center gap-2">
                          <i class="bi bi-translate"></i>
                          Bahasa Konten
                        </label>
                        <div class="btn-group btn-group-sm" role="group" id="biayaLangSwitch"
                          aria-label="Pilih bahasa biaya">
                          <button type="button" class="btn btn-success active" data-biaya-lang-button="id">
                            <span class="me-1" aria-hidden="true"></span>
                            Indonesia
                          </button>
                          <button type="button" class="btn btn-outline-success" data-biaya-lang-button="en">
                            <span class="me-1" aria-hidden="true"></span>
                            English
                          </button>
                        </div>
                        <small class="text-muted d-block mt-2">
                          Lengkapi keterangan dan nominal dalam dua bahasa. Nominal dapat disesuaikan (misal format
                          IDR).
                        </small>
                      </div>

                      <div class="biaya-lang-pane" data-biaya-lang-pane="id">
                        <div class="mb-3">
                          <label for="biayaLabel_id" class="form-label">Keterangan (Bahasa Indonesia)</label>
                          <input type="text" class="form-control" id="biayaLabel_id"
                            placeholder="Contoh: Biaya Pendaftaran">
                        </div>
                        <div class="mb-3">
                          <label for="biayaAmount_id" class="form-label">Nominal (Bahasa Indonesia)</label>
                          <input type="text" class="form-control" id="biayaAmount_id"
                            placeholder="Contoh: Rp 300.000,-">
                        </div>
                      </div>

                      <div class="biaya-lang-pane d-none" data-biaya-lang-pane="en">
                        <div class="mb-3">
                          <label for="biayaLabel_en" class="form-label">Label (English)</label>
                          <input type="text" class="form-control" id="biayaLabel_en"
                            placeholder="Example: Registration Fee">
                        </div>
                        <div class="mb-3">
                          <label for="biayaAmount_en" class="form-label">Amount (English)</label>
                          <input type="text" class="form-control" id="biayaAmount_en"
                            placeholder="Example: IDR 300,000">
                        </div>
                      </div>

                      <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary flex-grow-1" id="btnSaveBiaya">
                          <i class="bi bi-save"></i> Simpan Biaya
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="btnResetBiaya">
                          <i class="bi bi-x-circle"></i> Reset
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              <div class="col-lg-8">
                <div class="card h-100">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-table"></i> Daftar Biaya</h5>
                    <button type="button" class="btn btn-light btn-sm" onclick="loadBiayaItems()">
                      <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table table-hover align-middle">
                        <thead>
                          <tr>
                            <th style="width:80px">Urutan</th>
                            <th>Keterangan</th>
                            <th>Nominal</th>
                            <th style="width:180px">Aksi</th>
                          </tr>
                        </thead>
                        <tbody id="biayaTableBody">
                          <tr>
                            <td colspan="4" class="text-center text-muted py-4">
                              <i class="bi bi-arrow-clockwise me-2"></i>Data belum dimuat
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <small class="text-muted">Gunakan tombol panah untuk mengatur urutan biaya.</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Brosur -->
          <div id="tab-brosur" class="tab-content" style="display:none">
            <div class="page-header">
              <h2><i class="bi bi-file-earmark-text"></i> Kelola Brosur</h2>
              <p>Kelola daftar brosur yang bisa diunduh calon santri</p>
            </div>

            <div class="row g-3">
              <div class="col-lg-5">
                <div class="card h-100">
                  <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-plus-circle"></i> Tambah / Edit Brosur</h5>
                  </div>
                  <div class="card-body">
                    <form id="brosurForm">
                      <input type="hidden" id="brosurId">
                      <div class="mb-3">
                        <label class="form-label d-flex align-items-center gap-2">
                          <i class="bi bi-translate"></i>
                          Bahasa Konten
                        </label>
                        <div class="btn-group btn-group-sm" role="group" id="brosurLangSwitch"
                          aria-label="Pilih bahasa brosur">
                          <button type="button" class="btn btn-success active" data-brosur-lang-button="id">
                            <span class="me-1" aria-hidden="true"></span>
                            Indonesia
                          </button>
                          <button type="button" class="btn btn-outline-success" data-brosur-lang-button="en">
                            <span class="me-1" aria-hidden="true"></span>
                            English
                          </button>
                        </div>
                        <small class="text-muted d-block mt-2">
                          Isi judul, deskripsi, dan label tombol dalam dua bahasa. URL dan ikon berlaku sama untuk semua
                          bahasa.
                        </small>
                      </div>

                      <div class="brosur-lang-pane" data-brosur-lang-pane="id">
                        <div class="mb-3">
                          <label for="brosurTitle_id" class="form-label">Judul (Bahasa Indonesia)</label>
                          <input type="text" class="form-control" id="brosurTitle_id"
                            placeholder="Contoh: Brosur Umum PPDSB">
                        </div>
                        <div class="mb-3">
                          <label for="brosurDescription_id" class="form-label">Deskripsi (Bahasa Indonesia)</label>
                          <textarea class="form-control" id="brosurDescription_id" rows="3"
                            placeholder="Deskripsi singkat brosur"></textarea>
                        </div>
                        <div class="mb-3">
                          <label for="brosurButtonLabel_id" class="form-label">Label Tombol (Bahasa Indonesia)</label>
                          <input type="text" class="form-control" id="brosurButtonLabel_id"
                            placeholder="Contoh: Unduh PDF" value="Unduh PDF">
                        </div>
                      </div>

                      <div class="brosur-lang-pane d-none" data-brosur-lang-pane="en">
                        <div class="mb-3">
                          <label for="brosurTitle_en" class="form-label">Title (English)</label>
                          <input type="text" class="form-control" id="brosurTitle_en"
                            placeholder="Example: General Prospectus">
                        </div>
                        <div class="mb-3">
                          <label for="brosurDescription_en" class="form-label">Description (English)</label>
                          <textarea class="form-control" id="brosurDescription_en" rows="3"
                            placeholder="Short description of the brochure"></textarea>
                        </div>
                        <div class="mb-3">
                          <label for="brosurButtonLabel_en" class="form-label">Button Label (English)</label>
                          <input type="text" class="form-control" id="brosurButtonLabel_en"
                            placeholder="Example: Download PDF" value="Download PDF">
                        </div>
                      </div>

                      <div class="mb-3">
                        <label for="brosurFile" class="form-label">Upload PDF Brosur</label>
                        <input type="file" class="form-control" id="brosurFile" accept="application/pdf">
                        <small class="text-muted d-block mt-1" id="brosurUploadHelp">
                          Unggah file PDF (maks 8MB). URL unduhan akan diisi otomatis setelah upload.
                        </small>
                        <input type="hidden" id="brosurFilePath">
                        <input type="hidden" id="brosurFileSize">
                        <input type="hidden" id="brosurFileMime" value="application/pdf">
                      </div>
                      <div class="mb-3">
                        <label for="brosurButtonUrl" class="form-label">URL Unduhan (Otomatis)</label>
                        <input type="url" class="form-control" id="brosurButtonUrl" placeholder="Hasil upload PDF"
                          readonly>
                      </div>
                      <div class="mb-3">
                        <label for="brosurIconClass" class="form-label">Kelas Ikon</label>
                        <input type="text" class="form-control" id="brosurIconClass"
                          placeholder="Contoh: bi bi-file-earmark-arrow-down" value="bi bi-file-earmark-arrow-down">
                        <small class="text-muted">Gunakan kelas ikon Bootstrap Icons</small>
                      </div>
                      <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary flex-grow-1" id="btnSaveBrosur">
                          <i class="bi bi-save"></i> Simpan Brosur
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="btnResetBrosur">
                          <i class="bi bi-x-circle"></i> Reset
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              <div class="col-lg-7">
                <div class="card h-100">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-journal-text"></i> Daftar Brosur</h5>
                    <button type="button" class="btn btn-light btn-sm" onclick="loadBrosurItems()">
                      <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table table-hover align-middle">
                        <thead>
                          <tr>
                            <th style="width:80px">Urutan</th>
                            <th>Judul</th>
                            <th>Link</th>
                            <th style="width:200px">Aksi</th>
                          </tr>
                        </thead>
                        <tbody id="brosurTableBody">
                          <tr>
                            <td colspan="4" class="text-center text-muted py-4">
                              <i class="bi bi-arrow-clockwise me-2"></i>Data belum dimuat
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <small class="text-muted">Pastikan tautan brosur mengarah ke file PDF.</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Kontak -->
          <div id="tab-kontak" class="tab-content" style="display:none">
            <div class="page-header">
              <h2><i class="bi bi-telephone"></i> Kelola Kontak</h2>
              <p>Atur daftar saluran kontak dan tautan peta lokasi</p>
            </div>

            <div class="row g-3">
              <div class="col-lg-6">
                <div class="card h-100">
                  <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-person-lines-fill"></i> Tambah / Edit Kontak</h5>
                  </div>
                  <div class="card-body">
                    <form id="kontakForm">
                      <input type="hidden" id="kontakId">
                      <div class="mb-3">
                        <label class="form-label d-flex align-items-center gap-2">
                          <i class="bi bi-translate"></i>
                          Bahasa Konten
                        </label>
                        <div class="btn-group btn-group-sm" role="group" id="kontakLangSwitch"
                          aria-label="Pilih bahasa kontak">
                          <button type="button" class="btn btn-success active" data-kontak-lang-button="id">
                            <span class="me-1" aria-hidden="true"></span>
                            Indonesia
                          </button>
                          <button type="button" class="btn btn-outline-success" data-kontak-lang-button="en">
                            <span class="me-1" aria-hidden="true"></span>
                            English
                          </button>
                        </div>
                        <small class="text-muted d-block mt-2">
                          Isi judul dan nilai kontak (misal alamat atau pesan) dalam kedua bahasa. Untuk nomor telepon,
                          boleh sama.
                        </small>
                      </div>

                      <div class="kontak-lang-pane" data-kontak-lang-pane="id">
                        <div class="mb-3">
                          <label for="kontakTitle_id" class="form-label">Judul (Bahasa Indonesia)</label>
                          <input type="text" class="form-control" id="kontakTitle_id" placeholder="Contoh: WhatsApp">
                        </div>
                        <div class="mb-3">
                          <label for="kontakValue_id" class="form-label">Nilai (Bahasa Indonesia)</label>
                          <input type="text" class="form-control" id="kontakValue_id"
                            placeholder="Contoh: +62 812-3456-7890">
                        </div>
                      </div>

                      <div class="kontak-lang-pane d-none" data-kontak-lang-pane="en">
                        <div class="mb-3">
                          <label for="kontakTitle_en" class="form-label">Title (English)</label>
                          <input type="text" class="form-control" id="kontakTitle_en" placeholder="Example: WhatsApp">
                        </div>
                        <div class="mb-3">
                          <label for="kontakValue_en" class="form-label">Value (English)</label>
                          <input type="text" class="form-control" id="kontakValue_en"
                            placeholder="Example: +62 812-3456-7890">
                        </div>
                      </div>

                      <div class="mb-3">
                        <label for="kontakType" class="form-label">Jenis</label>
                        <select class="form-select" id="kontakType">
                          <option value="info">Info Lainnya</option>
                          <option value="whatsapp">WhatsApp</option>
                          <option value="email">Email</option>
                          <option value="address">Alamat</option>
                          <option value="phone">Telepon</option>
                          <option value="website">Website</option>
                        </select>
                      </div>
                      <div class="mb-3">
                        <label for="kontakLinkUrl" class="form-label">URL (Opsional)</label>
                        <input type="url" class="form-control" id="kontakLinkUrl" placeholder="https:// atau mailto:">
                        <small class="text-muted">Kosongkan jika tidak perlu tautan</small>
                      </div>
                      <div class="mb-3">
                        <label for="kontakIconClass" class="form-label">Kelas Ikon</label>
                        <input type="text" class="form-control" id="kontakIconClass"
                          placeholder="Contoh: bi bi-whatsapp" value="bi bi-info-circle">
                      </div>
                      <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary flex-grow-1" id="btnSaveKontak">
                          <i class="bi bi-save"></i> Simpan Kontak
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="btnResetKontak">
                          <i class="bi bi-x-circle"></i> Reset
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="card h-100">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-list-ul"></i> Daftar Kontak</h5>
                    <button type="button" class="btn btn-light btn-sm" onclick="loadKontakItems()">
                      <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table table-hover align-middle">
                        <thead>
                          <tr>
                            <th style="width:80px">Urutan</th>
                            <th>Judul</th>
                            <th>Nilai</th>
                            <th style="width:200px">Aksi</th>
                          </tr>
                        </thead>
                        <tbody id="kontakTableBody">
                          <tr>
                            <td colspan="4" class="text-center text-muted py-4">
                              <i class="bi bi-arrow-clockwise me-2"></i>Data belum dimuat
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <small class="text-muted">Gunakan tombol panah untuk mengatur urutan kontak.</small>
                  </div>
                </div>
              </div>
            </div>

            <div class="row g-3 mt-2">
              <div class="col-12">
                <div class="card">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-geo-alt"></i> Pengaturan Peta Lokasi</h5>
                    <button type="button" class="btn btn-light btn-sm" onclick="loadKontakSettings()">
                      <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                  </div>
                  <div class="card-body">
                    <form id="kontakSettingsForm">
                      <div class="mb-3">
                        <label for="kontakMapUrl" class="form-label">URL Embed Google Maps</label>
                        <input type="url" class="form-control" id="kontakMapUrl"
                          placeholder="https://www.google.com/maps/embed?..." required>
                        <small class="text-muted">Gunakan URL embed yang dimulai dengan
                          https://www.google.com/maps/embed?...</small>
                      </div>
                      <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary" id="btnSaveKontakSettings">
                          <i class="bi bi-save"></i> Simpan Map
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Payment Settings -->
          <div id="tab-payment-settings" class="tab-content" style="display:none">
            <div class="page-header d-flex justify-content-between align-items-center">
              <div>
                <h2><i class="bi bi-credit-card"></i> Pengaturan Pembayaran</h2>
                <p>Kelola metode pembayaran (Transfer Bank & QRIS)</p>
              </div>
              <div class="text-end">
                <button type="button" class="btn btn-primary" onclick="savePaymentSettings()">
                  <i class="bi bi-save"></i> Simpan Perubahan
                </button>
              </div>
            </div>

            <div class="row g-3">
              <!-- Bank Transfer Settings -->
              <div class="col-lg-6">
                <div class="card h-100 border-0 shadow-sm">
                  <div class="card-header bg-white">
                    <h5 class="mb-0"><i class="bi bi-bank"></i> Transfer Bank</h5>
                  </div>
                  <div class="card-body">
                    <form id="bankSettingsForm">
                      <div class="mb-3">
                        <label class="form-label">Nama Bank</label>
                        <input type="text" class="form-control" id="payment-bank-name" placeholder="Contoh: Bank BRI">
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Nomor Rekening</label>
                        <input type="text" class="form-control" id="payment-bank-account"
                          placeholder="Contoh: 1234-5678-9012">
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Atas Nama</label>
                        <input type="text" class="form-control" id="payment-bank-holder"
                          placeholder="Contoh: Yayasan Al Ikhsan">
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Nominal Pembayaran (Rp)</label>
                        <input type="number" class="form-control" id="payment-nominal" placeholder="Contoh: 250000">
                        <small class="text-muted">Nominal yang harus ditransfer siswa via Bank.</small>
                      </div>
                    </form>
                  </div>
                </div>
              </div>

              <!-- QRIS Settings -->
              <div class="col-lg-6">
                <div class="card h-100 border-0 shadow-sm">
                  <div class="card-header bg-white">
                    <h5 class="mb-0"><i class="bi bi-qr-code"></i> QRIS</h5>
                  </div>
                  <div class="card-body">
                    <form id="qrisSettingsForm">
                      <div class="mb-3 d-none">
                        <label class="form-label">Kode QRIS (Terisi Otomatis)</label>
                        <textarea class="form-control font-monospace bg-light" id="payment-qris-data" rows="3"
                          placeholder="Akan terisi otomatis setelah upload gambar..." readonly></textarea>
                        <small class="text-muted">Kode ini otomatis diekstrak dari gambar yang Anda upload. Jika kosong,
                          pastikan gambar QRIS jelas.</small>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Upload Gambar QRIS</label>
                        <input type="file" class="form-control" id="payment-qris-file" accept="image/*">
                        <small class="text-muted">Pilih gambar QRIS dari galeri. Sistem akan otomatis membaca
                          kodenya.</small>
                      </div>
                      <div class="mb-3 text-center p-3 border rounded bg-light">
                        <p class="mb-2 text-muted">Preview QRIS Saat Ini:</p>
                        <img id="payment-qris-preview" src="" alt="QRIS Preview" class="img-fluid rounded shadow-sm"
                          style="max-height: 200px; display: none;">
                        <p id="payment-qris-none" class="text-muted small fst-italic mt-2">Belum ada gambar QRIS</p>

                        <!-- Status Indicator -->
                        <div id="qris-data-status" class="mt-2" style="display:none">
                          <span class="badge bg-success"><i class="bi bi-check-circle"></i> Data QRIS Terbaca</span>
                        </div>
                        <div id="qris-data-missing" class="mt-2" style="display:none">
                          <span class="badge bg-warning text-dark"><i class="bi bi-exclamation-triangle"></i> Data QRIS
                            Tidak Terbaca (Hanya Gambar)</span>
                        </div>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Nominal QRIS (Rp)</label>
                        <input type="number" class="form-control" id="payment-qris-nominal"
                          placeholder="Contoh: 250000">
                        <small class="text-muted">Nominal yang harus dibayar via QRIS (biasanya sama).</small>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Maintenance -->
          <div id="tab-maintenance" class="tab-content" style="display:none">
            <div class="page-header d-flex justify-content-between align-items-center">
              <div>
                <h2><i class="bi bi-tools"></i> Mode Maintenance</h2>
                <p>Aktifkan mode perawatan untuk menutup seluruh halaman publik sementara</p>
              </div>
              <div class="text-end">
                <span class="badge bg-secondary" id="maintenanceStatusBadge">
                  <i class="bi bi-info-circle"></i> Status belum dimuat
                </span>
              </div>
            </div>

            <div class="row g-3">
              <div class="col-lg-5">
                <div class="card h-100 border-0 shadow-sm">
                  <div class="card-body">
                    <div class="d-flex align-items-center gap-3 mb-3">
                      <div
                        class="rounded-circle bg-success bg-opacity-25 text-success d-flex align-items-center justify-content-center"
                        style="width:60px;height:60px;font-size:1.8rem;">
                        <i class="bi bi-shield-exclamation"></i>
                      </div>
                      <div>
                        <h5 class="mb-1">Status Sistem</h5>
                        <p class="text-muted mb-0 small" id="maintenanceStatusSummary">
                          Menunggu data terbaru...
                        </p>
                      </div>
                    </div>
                    <div id="maintenanceActiveAlert" class="alert alert-warning d-none" role="alert">
                      <div class="d-flex gap-2">
                        <i class="bi bi-exclamation-triangle-fill"></i>
                        <div>
                          <strong>Situs sedang maintenance</strong>
                          <p class="mb-0 small" id="maintenanceActiveMessagePreview">Pengunjung tidak dapat mengakses
                            form
                            pendaftaran dan pembayaran.</p>
                        </div>
                      </div>
                    </div>
                    <div class="border rounded p-3 bg-light mt-3">
                      <p class="mb-1 text-muted small">Pesan yang dilihat pengunjung:</p>
                      <p class="mb-0 fw-semibold" id="maintenancePreviewMessage">-</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-lg-7">
                <div class="card border-0 shadow-sm">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-toggle2-on"></i> Pengaturan Mode Maintenance</h5>
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="maintenanceRefreshBtn">
                      <i class="bi bi-arrow-clockwise"></i> Muat Ulang Status
                    </button>
                  </div>
                  <div class="card-body">
                    <form id="maintenanceForm">
                      <div class="form-check form-switch form-switch-lg mb-3">
                        <input class="form-check-input" type="checkbox" role="switch" id="maintenanceToggle">
                        <label class="form-check-label fw-semibold" for="maintenanceToggle">
                          Aktifkan Mode Maintenance
                        </label>
                        <div class="text-muted small">
                          Saat aktif, seluruh halaman publik akan terkunci dan menampilkan pesan yang Anda tulis.
                        </div>
                      </div>
                      <div class="mb-3">
                        <label for="maintenanceMessageInput" class="form-label">Pesan untuk Pengunjung</label>
                        <textarea id="maintenanceMessageInput" class="form-control" rows="4"
                          placeholder="Contoh: Situs sedang perawatan hingga pukul 14.00 WIB. Terima kasih atas pengertiannya."></textarea>
                        <small class="text-muted">Gunakan nada sopan dan berikan estimasi waktu selesai.</small>
                      </div>
                      <div class="d-flex flex-wrap gap-2">
                        <button type="submit" class="btn btn-success" id="maintenanceSaveBtn">
                          <i class="bi bi-save"></i> Simpan Pengaturan
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="maintenanceResetBtn">
                          <i class="bi bi-arrow-repeat"></i> Reset Form
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Kelola Akun Admin -->
          <div id="tab-akun-admin" class="tab-content" style="display:none">
            <div class="page-header">
              <h2><i class="bi bi-person-plus-fill"></i> Kelola Akun Admin</h2>
              <p>Tambah akun admin baru untuk akses panel administrasi</p>
            </div>

            <div class="row g-4">
              <!-- Form Tambah Akun -->
              <div class="col-lg-5">
                <div class="card border-0 shadow-sm">
                  <div class="card-header"
                    style="background: linear-gradient(135deg, #0d9463 0%, #065f46 100%); color: white;">
                    <h5 class="mb-0"><i class="bi bi-person-plus me-2"></i>Tambah Akun Admin Baru</h5>
                  </div>
                  <div class="card-body">
                    <form id="formTambahAdmin" onsubmit="tambahAkunAdmin(event)">
                      <div class="mb-3">
                        <label class="form-label fw-semibold">
                          <i class="bi bi-envelope me-1"></i> Email
                        </label>
                        <input type="email" class="form-control" id="newAdminEmail" required
                          placeholder="contoh@email.com">
                      </div>
                      <div class="mb-3">
                        <label class="form-label fw-semibold">
                          <i class="bi bi-lock me-1"></i> Password
                        </label>
                        <div class="input-group">
                          <input type="password" class="form-control" id="newAdminPassword" required
                            placeholder="Minimal 6 karakter" minlength="6">
                          <button class="btn btn-outline-secondary" type="button" onclick="toggleNewAdminPassword()">
                            <i class="bi bi-eye" id="iconTogglePassword"></i>
                          </button>
                        </div>
                        <small class="text-muted">Password minimal 6 karakter</small>
                      </div>
                      <div class="mb-4">
                        <label class="form-label fw-semibold">
                          <i class="bi bi-lock-fill me-1"></i> Konfirmasi Password
                        </label>
                        <input type="password" class="form-control" id="newAdminPasswordConfirm" required
                          placeholder="Ulangi password">
                      </div>

                      <div class="alert alert-danger d-none" id="alertTambahAdmin">
                        <i class="bi bi-exclamation-triangle me-1"></i>
                        <span id="alertTambahAdminText"></span>
                      </div>

                      <div class="alert alert-success d-none" id="alertSuksesAdmin">
                        <i class="bi bi-check-circle me-1"></i>
                        <span id="alertSuksesAdminText"></span>
                      </div>

                      <button type="submit" class="btn btn-success w-100" id="btnTambahAdmin">
                        <i class="bi bi-plus-circle me-1"></i> Tambah Akun Admin
                      </button>
                    </form>
                  </div>
                </div>
              </div>

              <!-- Daftar Akun Admin -->
              <div class="col-lg-7">
                <div class="card border-0 shadow-sm">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-people me-2"></i>Daftar Akun Admin</h5>
                    <button class="btn btn-outline-secondary btn-sm" onclick="loadAdminUsers()">
                      <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                  </div>
                  <div class="card-body">
                    <!-- Loading State -->
                    <div id="adminUsersLoading" class="text-center py-4">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                      <p class="text-muted mt-2">Memuat daftar admin...</p>
                    </div>

                    <!-- Error State -->
                    <div id="adminUsersError" class="alert alert-danger d-none">
                      <i class="bi bi-exclamation-triangle me-1"></i>
                      <span id="adminUsersErrorText"></span>
                    </div>

                    <!-- Users List -->
                    <div id="adminUsersList" class="d-none">
                      <div class="table-responsive">
                        <table class="table table-hover align-middle">
                          <thead class="table-light">
                            <tr>
                              <th>Email</th>
                              <th>Dibuat</th>
                              <th>Terakhir Login</th>
                              <th class="text-end">Aksi</th>
                            </tr>
                          </thead>
                          <tbody id="adminUsersTableBody">
                            <!-- Populated by JS -->
                          </tbody>
                        </table>
                      </div>
                      <p class="text-muted small mt-2 mb-0">
                        <i class="bi bi-info-circle me-1"></i>
                        Total: <strong id="adminUsersCount">0</strong> akun admin
                      </p>
                    </div>

                    <!-- Info saat ini login -->
                    <div class="mt-3 p-3 bg-light rounded border-start border-success border-4">
                      <h6 class="fw-semibold mb-1"><i class="bi bi-person-check me-1"></i> Anda login sebagai:</h6>
                      <span class="badge bg-success fs-6" id="currentAdminEmailDisplay">-</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </section>
      </main>
    </div>

    <!-- Modal: Detail Pendaftar -->
    <div class="modal fade" id="detailModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"><i class="bi bi-person-badge"></i> Detail Pendaftar</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
          </div>
          <div class="modal-body">
            <div id="detailContent"><!-- populated by JS --></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Verifikasi Pendaftar -->
    <div class="modal fade" id="verifikasiModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="verifikasiModalTitle">Verifikasi Pendaftar</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
          </div>
          <div class="modal-body">
            <form id="verifikasiForm">
              <input type="hidden" id="verifikasi-id" />
              <input type="hidden" id="verifikasi-status" />

              <div class="mb-3">
                <label class="form-label">Status Verifikasi</label>
                <input type="text" class="form-control" id="verifikasi-status-display" readonly />
              </div>

              <div class="mb-3" id="catatanContainer">
                <label class="form-label" id="catatanLabel">Catatan</label>
                <textarea class="form-control" id="verifikasi-catatan" rows="4"
                  placeholder="Masukkan catatan..."></textarea>
                <small class="text-muted">Opsional: Berikan alasan atau catatan untuk keputusan ini</small>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
            <button type="button" class="btn btn-primary" onclick="confirmVerifikasi()"
              id="btnConfirmVerifikasi">Konfirmasi</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Detail Pembayaran -->
    <div class="modal fade" id="detailPembayaranModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"><i class="bi bi-credit-card"></i> Detail Pembayaran</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
          </div>
          <div class="modal-body">
            <div class="row g-3">
              <div class="col-md-6">
                <table class="table table-borderless detail-payment-table">
                  <tr>
                    <th width="40%">NISN:</th>
                    <td id="detail-nisn"></td>
                  </tr>
                  <tr>
                    <th>Nama Lengkap:</th>
                    <td id="detail-nama-lengkap"></td>
                  </tr>
                  <tr>
                    <th>Jumlah:</th>
                    <td id="detail-jumlah"></td>
                  </tr>
                  <tr>
                    <th>Metode:</th>
                    <td id="detail-metode"></td>
                  </tr>
                  <tr>
                    <th>Status:</th>
                    <td id="detail-status"></td>
                  </tr>
                  <tr>
                    <th>Tanggal Upload:</th>
                    <td id="detail-tanggal-upload"></td>
                  </tr>
                  <tr>
                    <th>Tanggal Verifikasi:</th>
                    <td id="detail-tanggal-verifikasi"></td>
                  </tr>
                  <tr>
                    <th>Verified By:</th>
                    <td id="detail-verified-by"></td>
                  </tr>
                  <tr>
                    <th>Catatan Admin:</th>
                    <td id="detail-catatan-admin"></td>
                  </tr>
                </table>
              </div>
              <div class="col-md-6">
                <h6 class="mb-3">Bukti Pembayaran:</h6>
                <div class="text-center">
                  <img id="detail-bukti-img" src="" alt="Bukti Pembayaran" class="img-fluid rounded shadow"
                    style="max-height:400px;cursor:pointer" onclick="window.open(this.src,'_blank')" />
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kembali</button>
            <button type="button" class="btn btn-success" onclick="openVerifikasiPembayaran('VERIFIED')"
              id="btnVerifyPayment">
              <i class="bi bi-check-circle"></i> Terima
            </button>
            <button type="button" class="btn btn-danger" onclick="openVerifikasiPembayaran('REJECTED')"
              id="btnRejectPayment">
              <i class="bi bi-x-circle"></i> Tolak
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Konfirmasi Verifikasi Pembayaran -->
    <div class="modal fade" id="verifikasiPembayaranModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="verifikasiPembayaranTitle">Konfirmasi Verifikasi</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="verify-nisn" />
            <input type="hidden" id="verify-status" />

            <div class="mb-3">
              <label class="form-label">Catatan Admin:</label>
              <textarea class="form-control" id="verify-catatan" rows="3"
                placeholder="Masukkan catatan (opsional)"></textarea>
            </div>

            <div class="alert" id="verify-alert" role="alert" style="display:none"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
            <button type="button" class="btn btn-primary" onclick="confirmVerifikasiPembayaran()"
              id="btnConfirmVerifyPayment">Konfirmasi</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS & App Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- jQuery (Required for Toastr) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Toastr JS for notifications (MUST load before admin.js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <!-- Toastr Configuration & Fallback -->
    <script>
      // Initialize Toastr
      if (typeof toastr !== 'undefined') {
        toastr.options = {
          closeButton: true,
          progressBar: true,
          positionClass: "toast-top-right",
          timeOut: "3000",
        };
      }
    </script>

    <!-- Supabase Client (UMD version for better compatibility) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <script>
      (async function () {
        try {
          // =====================================================
          // ADMIN AUTH CHECK - Using localStorage (stable)
          // =====================================================

          // Supabase credentials
          const SUPABASE_URL = 'https://sxbvadzcwpaovkhghttv.supabase.co';
          const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN4YnZhZHpjd3Bhb3ZraGdodHR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExMDg4MDYsImV4cCI6MjA3NjY4NDgwNn0.miJeKmsNgjgS4fWegGlwrxF_cPUoZBT0YKl1oxmmXTE';

          // ======================================================
          // FRESH SESSION DETECTION (sama dengan login.html)
          // ======================================================
          const SESSION_MARKER = 'admin_session_active';
          const hasSessionMarker = sessionStorage.getItem(SESSION_MARKER);

          if (!hasSessionMarker) {
            console.log('[ADMIN] Fresh browser session detected, clearing old auth data');

            // Clear Supabase auth data from localStorage
            const keysToRemove = [];
            for (let i = 0; i < localStorage.length; i++) {
              const key = localStorage.key(i);
              if (key && key.includes('supabase')) {
                keysToRemove.push(key);
              }
            }
            keysToRemove.forEach(key => localStorage.removeItem(key));

            sessionStorage.setItem(SESSION_MARKER, 'true');

            // Redirect to login since this is fresh session
            console.log('[ADMIN] Redirecting to login (fresh session)');
            window.location.replace('/login.html');
            return;
          }


          // ======================================================
          // STRICT SESSION RE-LOGIN ENFORCEMENT
          // Check if this is a fresh browser session (tab closed/reopened)
          // If so, clear stored credentials to force re-login
          // ======================================================
          (function checkFreshSession() {
            const SESSION_MARKER = 'admin_session_active';
            const hasSessionMarker = sessionStorage.getItem(SESSION_MARKER);

            if (!hasSessionMarker) {
              console.log('[AUTH] Fresh browser session detected on Admin Page.');
              console.log('[AUTH] Clearing persistent tokens to enforce re-login.');

              // Clear Supabase auth data from localStorage
              const keysToRemove = [];
              for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.includes('supabase')) {
                  keysToRemove.push(key);
                }
              }
              keysToRemove.forEach(key => localStorage.removeItem(key));
            } else {
              console.log('[AUTH] Active session marker found. Continuing.');
            }
          })();

          // Initialize Supabase client with default localStorage
          if (typeof supabase !== 'undefined' && supabase.createClient) {
            window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('[SUPABASE ADMIN]  Client initialized');
          } else {
            console.error('[SUPABASE ADMIN]  Supabase library not loaded');
            return;
          }

          // ===== AUTH CHECK =====
          console.log('[AUTH] Checking authentication...');
          const { data: { session }, error } = await window.supabase.auth.getSession();

          if (error) {
            console.error('[AUTH] Error:', error.message);
            window.location.replace('/login.html');
            return;
          }

          if (!session || !session.user) {
            console.log('[AUTH]  Not authenticated');
            window.location.replace('/login.html');
            return;
          }

          console.log('[AUTH]  Authenticated as:', session.user.email);

          // Display user email in sidebar
          const adminEmailEl = document.getElementById('adminEmail');
          if (adminEmailEl) {
            adminEmailEl.textContent = session.user.email;
          }

          // Show main content with fade-in
          const mainContent = document.getElementById('mainAdminContent');
          if (mainContent) {
            mainContent.style.opacity = '1';
          }

          // Hide loading overlay with fade-out
          const pageLoadingOverlay = document.getElementById('pageLoadingOverlay');
          if (pageLoadingOverlay) {
            pageLoadingOverlay.style.opacity = '0';
            pageLoadingOverlay.style.pointerEvents = 'none';
          }

          // ===== LOGOUT FUNCTIONALITY =====
          const logoutBtn = document.getElementById('logoutBtn');
          if (logoutBtn) {
            logoutBtn.addEventListener('click', async () => {
              console.log('[AUTH] Logging out...');
              logoutBtn.disabled = true;
              logoutBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Logout...';

              try {
                await window.supabase.auth.signOut();

                // Clear all session data
                sessionStorage.clear();

                console.log('[AUTH]  Logged out successfully');
                window.location.replace('/login.html');
              } catch (error) {
                console.error('[AUTH] Logout error:', error);
                logoutBtn.disabled = false;
                logoutBtn.innerHTML = '<i class="bi bi-box-arrow-right"></i> Logout';
              }
            });
          }

          // ===== REAL-TIME SYNC for gelombang =====
          const channel = window.supabase
            .channel('admin-gelombang-sync')
            .on('postgres_changes', {
              event: '*',
              schema: 'public',
              table: 'gelombang'
            }, (payload) => {
              console.log('[SUPABASE ADMIN]  Gelombang data changed:', payload);
              const gelombangTab = document.getElementById('tab-gelombang');
              if (gelombangTab && gelombangTab.style.display !== 'none') {
                if (typeof toastr !== 'undefined' && toastr.info) {
                  toastr.info('Data gelombang diperbarui dari sumber lain');
                }
                setTimeout(() => {
                  if (typeof loadGelombangData === 'function') {
                    loadGelombangData(true);
                  }
                }, 500);
              }
            })
            .subscribe((status) => {
              if (status === 'SUBSCRIBED') {
                console.log('[SUPABASE ADMIN]  Subscribed to real-time updates');
              }
            });

          window.addEventListener('beforeunload', () => {
            window.supabase.removeChannel(channel);
          });

        } catch (error) {
          console.error('[SUPABASE ADMIN]  Initialization error:', error);
        }
      })();
    </script>

    <!-- Admin Account Management Script -->
    <script>
      // Toggle password visibility for new admin form
      function toggleNewAdminPassword() {
        const passwordInput = document.getElementById('newAdminPassword');
        const icon = document.getElementById('iconTogglePassword');

        if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          icon.classList.remove('bi-eye');
          icon.classList.add('bi-eye-slash');
        } else {
          passwordInput.type = 'password';
          icon.classList.remove('bi-eye-slash');
          icon.classList.add('bi-eye');
        }
      }

      // Load admin users from backend API
      async function loadAdminUsers() {
        const loadingEl = document.getElementById('adminUsersLoading');
        const errorEl = document.getElementById('adminUsersError');
        const errorTextEl = document.getElementById('adminUsersErrorText');
        const listEl = document.getElementById('adminUsersList');
        const tableBodyEl = document.getElementById('adminUsersTableBody');
        const countEl = document.getElementById('adminUsersCount');

        // Show loading
        loadingEl.classList.remove('d-none');
        errorEl.classList.add('d-none');
        listEl.classList.add('d-none');

        try {
          console.log('[ADMIN USERS] Loading users...');
          const response = await fetch('/api/index?action=admin_users');
          const data = await response.json();

          if (!data.ok) {
            throw new Error(data.error || 'Failed to load users');
          }

          const users = data.users || [];
          console.log('[ADMIN USERS] Loaded', users.length, 'users');

          // Get current user email
          const currentEmail = document.getElementById('adminEmail')?.textContent || '';

          // Render table
          tableBodyEl.innerHTML = users.map(user => {
            const isCurrentUser = user.email === currentEmail;
            const createdDate = user.created_at ? new Date(user.created_at).toLocaleDateString('id-ID') : '-';
            const lastLogin = user.last_sign_in_at ? new Date(user.last_sign_in_at).toLocaleDateString('id-ID', {
              day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit'
            }) : 'Belum pernah';

            return `
            <tr class="${isCurrentUser ? 'table-success' : ''}">
              <td>
                <strong>${user.email}</strong>
                ${isCurrentUser ? '<span class="badge bg-success ms-2">Anda</span>' : ''}
              </td>
              <td><small class="text-muted">${createdDate}</small></td>
              <td><small class="text-muted">${lastLogin}</small></td>
              <td class="text-end">
                ${isCurrentUser ?
                '<span class="text-muted small">-</span>' :
                `<button class="btn btn-outline-danger btn-sm" onclick="deleteAdminUser('${user.id}', '${user.email}')" title="Hapus akun">
                    <i class="bi bi-trash"></i>
                  </button>`
              }
              </td>
            </tr>
          `;
          }).join('');

          countEl.textContent = users.length;

          // Show list
          loadingEl.classList.add('d-none');
          listEl.classList.remove('d-none');

        } catch (error) {
          console.error('[ADMIN USERS] Error:', error);
          loadingEl.classList.add('d-none');
          errorTextEl.textContent = error.message || 'Gagal memuat daftar admin';
          errorEl.classList.remove('d-none');
        }
      }

      // Delete admin user
      async function deleteAdminUser(userId, email) {
        if (!confirm(`Yakin ingin menghapus akun admin:\n${email}?`)) {
          return;
        }

        try {
          console.log('[ADMIN USERS] Deleting user:', userId);

          const response = await fetch(`/api/index?action=admin_users&user_id=${userId}`, {
            method: 'DELETE'
          });
          const data = await response.json();

          if (!data.ok) {
            throw new Error(data.error || 'Failed to delete user');
          }

          console.log('[ADMIN USERS]  User deleted');

          if (typeof toastr !== 'undefined') {
            toastr.success('Akun admin berhasil dihapus', 'Berhasil');
          }

          // Reload list
          loadAdminUsers();

        } catch (error) {
          console.error('[ADMIN USERS] Delete error:', error);
          if (typeof toastr !== 'undefined') {
            toastr.error(error.message || 'Gagal menghapus akun', 'Error');
          } else {
            alert('Error: ' + (error.message || 'Gagal menghapus akun'));
          }
        }
      }

      // Add new admin account using backend API
      async function tambahAkunAdmin(event) {
        event.preventDefault();

        const email = document.getElementById('newAdminEmail').value.trim();
        const password = document.getElementById('newAdminPassword').value;
        const passwordConfirm = document.getElementById('newAdminPasswordConfirm').value;
        const btnTambah = document.getElementById('btnTambahAdmin');
        const alertError = document.getElementById('alertTambahAdmin');
        const alertErrorText = document.getElementById('alertTambahAdminText');
        const alertSukses = document.getElementById('alertSuksesAdmin');
        const alertSuksesText = document.getElementById('alertSuksesAdminText');

        // Hide alerts
        alertError.classList.add('d-none');
        alertSukses.classList.add('d-none');

        // Validate
        if (!email || !password || !passwordConfirm) {
          alertErrorText.textContent = 'Semua field harus diisi';
          alertError.classList.remove('d-none');
          return;
        }

        if (password.length < 6) {
          alertErrorText.textContent = 'Password minimal 6 karakter';
          alertError.classList.remove('d-none');
          return;
        }

        if (password !== passwordConfirm) {
          alertErrorText.textContent = 'Password dan konfirmasi tidak sama';
          alertError.classList.remove('d-none');
          return;
        }

        // Loading state
        btnTambah.disabled = true;
        btnTambah.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span> Memproses...';

        try {
          console.log('[ADMIN USERS] Creating new admin:', email);

          // Use backend API instead of Supabase client
          const response = await fetch('/api/index?action=admin_users', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
          });

          const data = await response.json();

          if (!data.ok) {
            throw new Error(data.error || 'Failed to create user');
          }

          console.log('[ADMIN USERS]  Account created:', data.user);

          // Show success message
          alertSuksesText.textContent = 'Akun admin berhasil ditambahkan: ' + email;
          alertSukses.classList.remove('d-none');

          // Reset form
          document.getElementById('formTambahAdmin').reset();

          // Reload list
          loadAdminUsers();

          if (typeof toastr !== 'undefined') {
            toastr.success('Akun admin baru berhasil ditambahkan!', 'Berhasil');
          }

        } catch (error) {
          console.error('[ADMIN USERS] Error creating account:', error);

          alertErrorText.textContent = error.message || 'Gagal membuat akun admin';
          alertError.classList.remove('d-none');

          if (typeof toastr !== 'undefined') {
            toastr.error(error.message || 'Gagal membuat akun admin', 'Error');
          }
        } finally {
          btnTambah.disabled = false;
          btnTambah.innerHTML = '<i class="bi bi-plus-circle me-1"></i> Tambah Akun Admin';
        }
      }

      // Load users when tab is shown
      document.addEventListener('DOMContentLoaded', function () {
        const originalSwitchTab = window.switchTab;
        if (typeof originalSwitchTab === 'function') {
          window.switchTab = function (tabName) {
            originalSwitchTab(tabName);

            if (tabName === 'akun-admin') {
              // Update current admin email display
              const emailDisplay = document.getElementById('currentAdminEmailDisplay');
              const sidebarEmail = document.getElementById('adminEmail');
              if (emailDisplay && sidebarEmail) {
                emailDisplay.textContent = sidebarEmail.textContent || '-';
              }

              // Load admin users list
              loadAdminUsers();
            }
          };
        }
      });
    </script>



    <!-- Close mainAdminContent wrapper -->
  </div>

  <!-- jsQR for Auto-Scanning QRIS Images -->
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>

  <!-- Admin JS (load last, after all dependencies) - Async to prevent blocking -->
  <script defer src="/assets/js/admin.js?v=v12_stats_fix_real"></script>
	  <script defer src="/assets/js/pwa.js?v=10"></script>

  <!-- DEBUG: Test if admin.js loaded successfully -->
  <script>
    // Wait for admin.js to load (defer means it loads after DOM ready)
    window.addEventListener('load', function () {
      setTimeout(function () {
        // Check critical exposed functions
        const criticalFunctions = ['lihatDetail', 'exportToExcel', 'downloadAllZip', 'switchTab'];
        const missingFunctions = criticalFunctions.filter(fn => typeof window[fn] === 'undefined');

        if (missingFunctions.length > 0) {
          console.error(' CRITICAL: admin.js failed to load or has syntax error!');
          console.error(' Missing functions:', missingFunctions);
          alert(' ERROR: JavaScript gagal load!\n\nMissing: ' + missingFunctions.join(', ') + '\n\nSilakan:\n1. Hard refresh (Ctrl+Shift+R)\n2. Clear browser cache\n3. Check console untuk error');
        } else {
          console.log(' admin.js loaded successfully');
          console.log(' All critical functions exist:', criticalFunctions);
        }
      }, 1000);
    });
  </script>

  <!-- Hide loading overlay after page fully loaded -->
  <script>
    window.addEventListener('load', function () {
      console.log("[ADMIN]  Page fully loaded, hiding overlay...");
      const overlay = document.getElementById('pageLoadingOverlay');
      if (overlay) {
        setTimeout(() => {
          overlay.style.opacity = '0';
          overlay.style.transition = 'opacity 0.3s ease';
          setTimeout(() => {
            overlay.style.display = 'none';
            console.log("[ADMIN]  Ready!");
          }, 300);
        }, 500);
      }
    });
  </script>



</body>

</html>
