<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#14532d" />
  <title>PPDSB â€“ Offline</title>
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="icon" href="/favicon.ico" />
  <link rel="icon" type="image/png" href="/favicon.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  <link rel="stylesheet" href="/assets/css/tailwind.css" />
</head>
<body class="min-h-screen bg-slate-900 text-white flex items-center justify-center px-6">
  <main class="max-w-md text-center space-y-4">
    <img src="/logo-bimi.svg" alt="Logo PPDSB" class="h-16 mx-auto" />
    <h1 class="text-2xl font-semibold">Anda Sedang Offline</h1>
    <p class="text-slate-200">
      Koneksi internet tidak tersedia. Kami menyimpan beberapa halaman penting secara lokal,
      jadi silakan coba lagi setelah koneksi kembali normal.
    </p>
    <a href="/" class="inline-flex items-center justify-center rounded-md bg-emerald-500 px-4 py-2 font-medium hover:bg-emerald-600 transition">
      Kembali ke Beranda
    </a>
  </main>
  <script src="/assets/js/pwa.js" defer></script>



  <style>
  /* Bubble */
  #chat-bubble {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #2ecc71; /* hijau pondok */
    color: white;
    width: 65px;
    height: 65px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 9999;
    transition: transform 0.2s;
  }
  #chat-bubble:hover {
    transform: scale(1.1);
  }

  /* Chat Box */
  #chat-box {
    position: fixed;
    bottom: 100px;
    right: 20px;
    width: 340px;
    height: 460px;
    background: white;
    border-radius: 12px;
    display: none;
    flex-direction: column;
    box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    z-index: 9999;
    border: 1px solid #dfdfdf;
    overflow: hidden;
  }

  #chat-header {
    background: #2ecc71;
    color: white;
    padding: 14px;
    text-align: center;
    font-size: 18px;
    font-weight: bold;
  }

  #chat-messages {
    flex: 1;
    padding: 12px;
    overflow-y: auto;
    font-size: 15px;
    background: #fafafa;
  }

  .msg-user {
    background: #d4f9df;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 8px;
    text-align: right;
  }

  .msg-bot {
    background: #eeeeee;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 8px;
    text-align: left;
  }

  #typing-indicator {
    display: none;
    font-style: italic;
    color: #555;
    margin: 0 12px 10px 12px;
  }

  /* Loading dots animation */
  .dots::after {
    content: " ...";
    animation: dots 1.5s steps(4, end) infinite;
  }

  @keyframes dots {
    0%, 20% { content: " ."; }
    40% { content: " .."; }
    60% { content: " ..."; }
    80%, 100% { content: " ."; }
  }

  #chat-input-area {
    display: flex;
    border-top: 1px solid #ddd;
  }

  #chat-input {
    flex: 1;
    border: none;
    padding: 12px;
    font-size: 15px;
  }

  #chat-send {
    width: 70px;
    border: none;
    background: #2ecc71;
    color: white;
    cursor: pointer;
  }

  @media (max-width: 640px) {
    #chat-box {
      width: calc(100vw - 32px);
      height: 70vh;
      right: 16px;
      bottom: 90px;
    }
    #chat-bubble {
      right: 16px;
      bottom: 16px;
    }
  }
</style>

<div id="chat-bubble">ðŸ’¬</div>

<div id="chat-box">
  <div id="chat-header">Chat Pondok</div>
  <div id="chat-messages"></div>
  <div id="typing-indicator">Bot sedang mengetik<span class="dots"></span></div>
  <div id="chat-input-area">
    <input type="text" id="chat-input" placeholder="Tulis pesan...">
    <button id="chat-send">Kirim</button>
  </div>
</div>

<script>
  const bubble = document.getElementById("chat-bubble");
  const box = document.getElementById("chat-box");
  const messages = document.getElementById("chat-messages");
  const input = document.getElementById("chat-input");
  const sendBtn = document.getElementById("chat-send");
  const typing = document.getElementById("typing-indicator");
  const API_URL = "https://pondok-chatbot.dewasatriaaa.workers.dev/";

  const toggleChat = () => {
    box.style.display = box.style.display === "flex" ? "none" : "flex";
  };

  const scrollToBottom = () => {
    messages.scrollTop = messages.scrollHeight;
  };

  function appendMessage(text, type) {
    messages.innerHTML += `<div class="msg-${type}">${text}</div>`;
    scrollToBottom();
  }

  function showTyping(show) {
    typing.style.display = show ? "block" : "none";
    scrollToBottom();
  }

  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;

    appendMessage(text, "user");
    input.value = "";
    showTyping(true);

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: text })
      });

      const data = await res.json();
      appendMessage(data.reply || "Maaf, terjadi kesalahan.", "bot");
    } catch (err) {
      appendMessage("Maaf, terjadi kesalahan koneksi.", "bot");
    } finally {
      showTyping(false);
    }
  }

  bubble.onclick = toggleChat;
  sendBtn.onclick = sendMessage;
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") sendMessage();
  });
</script>

</body>
</html>
