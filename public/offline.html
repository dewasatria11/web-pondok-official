<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#14532d" />
  <title>PPDSB â€“ Offline</title>
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="icon" href="/favicon.ico" />
  <link rel="icon" type="image/png" href="/favicon.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  <link rel="stylesheet" href="/assets/css/tailwind.css" />
</head>
<body class="min-h-screen bg-slate-900 text-white flex items-center justify-center px-6">
  <main class="max-w-md text-center space-y-4">
    <img src="/logo-bimi.svg" alt="Logo PPDSB" class="h-16 mx-auto" />
    <h1 class="text-2xl font-semibold">Anda Sedang Offline</h1>
    <p class="text-slate-200">
      Koneksi internet tidak tersedia. Kami menyimpan beberapa halaman penting secara lokal,
      jadi silakan coba lagi setelah koneksi kembali normal.
    </p>
    <a href="/" class="inline-flex items-center justify-center rounded-md bg-emerald-500 px-4 py-2 font-medium hover:bg-emerald-600 transition">
      Kembali ke Beranda
    </a>
  </main>
  <script src="/assets/js/pwa.js" defer></script>

  <style>
  #chat-bubble {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #1e88e5;
    color: white;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 9999;
  }

  #chat-box {
    position: fixed;
    bottom: 95px;
    right: 20px;
    width: 320px;
    height: 420px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    display: none;
    flex-direction: column;
    overflow: hidden;
    z-index: 9999;
    border: 1px solid #ddd;
  }

  #chat-header {
    background: #1e88e5;
    color: white;
    padding: 12px;
    font-size: 18px;
    text-align: center;
  }

  #chat-messages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    font-size: 14px;
  }

  .msg-user {
    background: #e0f2ff;
    padding: 8px 10px;
    border-radius: 6px;
    margin-bottom: 8px;
    text-align: right;
  }

  .msg-bot {
    background: #f1f1f1;
    padding: 8px 10px;
    border-radius: 6px;
    margin-bottom: 8px;
    text-align: left;
  }

  #chat-input-area {
    display: flex;
    border-top: 1px solid #ddd;
  }

  #chat-input {
    flex: 1;
    border: none;
    padding: 10px;
    font-size: 14px;
  }

  #chat-send {
    width: 60px;
    border: none;
    background: #1e88e5;
    color: white;
    cursor: pointer;
  }
</style>

<div id="chat-bubble">ðŸ’¬</div>

<div id="chat-box">
  <div id="chat-header">Chat Pondok</div>
  <div id="chat-messages"></div>

  <div id="chat-input-area">
    <input type="text" id="chat-input" placeholder="Tulis pesan...">
    <button id="chat-send">Kirim</button>
  </div>
</div>

<script>
  const bubble = document.getElementById("chat-bubble");
  const box = document.getElementById("chat-box");
  const messages = document.getElementById("chat-messages");
  const input = document.getElementById("chat-input");
  const sendBtn = document.getElementById("chat-send");

  bubble.onclick = () => {
    box.style.display = box.style.display === "flex" ? "none" : "flex";
  };

  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;

    messages.innerHTML += `<div class="msg-user">${text}</div>`;
    messages.scrollTop = messages.scrollHeight;
    input.value = "";

    const res = await fetch("https://pondok-chatbot.dewasatriaaa.workers.dev/", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: text })
    });

    const data = await res.json();
    const reply = data.reply || "Maaf, terjadi kesalahan.";

    messages.innerHTML += `<div class="msg-bot">${reply}</div>`;
    messages.scrollTop = messages.scrollHeight;
  }

  sendBtn.onclick = sendMessage;
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") sendMessage();
  });
</script>

</body>
</html>
